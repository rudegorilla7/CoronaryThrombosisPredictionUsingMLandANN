<html>
<head>
<title>decoder.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6897bb;}
.s3 { color: #808080;}
.s4 { color: #6a8759;}
.s5 { color: #629755; font-style: italic;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
decoder.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">datetime</span>
<span class="s0">import </span><span class="s1">io</span>
<span class="s0">from </span><span class="s1">os </span><span class="s0">import </span><span class="s1">linesep</span>
<span class="s0">import </span><span class="s1">re</span>
<span class="s0">import </span><span class="s1">sys</span>

<span class="s0">from </span><span class="s1">pip._vendor.toml.tz </span><span class="s0">import </span><span class="s1">TomlTz</span>

<span class="s0">if </span><span class="s1">sys.version_info &lt; (</span><span class="s2">3</span><span class="s0">,</span><span class="s1">):</span>
    <span class="s1">_range = xrange  </span><span class="s3"># noqa: F821</span>
<span class="s0">else</span><span class="s1">:</span>
    <span class="s1">unicode = str</span>
    <span class="s1">_range = range</span>
    <span class="s1">basestring = str</span>
    <span class="s1">unichr = chr</span>


<span class="s0">def </span><span class="s1">_detect_pathlib_path(p):</span>
    <span class="s0">if </span><span class="s1">(</span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">) &lt;= sys.version_info:</span>
        <span class="s0">import </span><span class="s1">pathlib</span>
        <span class="s0">if </span><span class="s1">isinstance(p</span><span class="s0">, </span><span class="s1">pathlib.PurePath):</span>
            <span class="s0">return True</span>
    <span class="s0">return False</span>


<span class="s0">def </span><span class="s1">_ispath(p):</span>
    <span class="s0">if </span><span class="s1">isinstance(p</span><span class="s0">, </span><span class="s1">(bytes</span><span class="s0">, </span><span class="s1">basestring)):</span>
        <span class="s0">return True</span>
    <span class="s0">return </span><span class="s1">_detect_pathlib_path(p)</span>


<span class="s0">def </span><span class="s1">_getpath(p):</span>
    <span class="s0">if </span><span class="s1">(</span><span class="s2">3</span><span class="s0">, </span><span class="s2">6</span><span class="s1">) &lt;= sys.version_info:</span>
        <span class="s0">import </span><span class="s1">os</span>
        <span class="s0">return </span><span class="s1">os.fspath(p)</span>
    <span class="s0">if </span><span class="s1">_detect_pathlib_path(p):</span>
        <span class="s0">return </span><span class="s1">str(p)</span>
    <span class="s0">return </span><span class="s1">p</span>


<span class="s0">try</span><span class="s1">:</span>
    <span class="s1">FNFError = FileNotFoundError</span>
<span class="s0">except </span><span class="s1">NameError:</span>
    <span class="s1">FNFError = IOError</span>


<span class="s1">TIME_RE = re.compile(</span><span class="s4">r&quot;([0-9]{2}):([0-9]{2}):([0-9]{2})(\.([0-9]{3,6}))?&quot;</span><span class="s1">)</span>


<span class="s0">class </span><span class="s1">TomlDecodeError(ValueError):</span>
    <span class="s5">&quot;&quot;&quot;Base toml Exception / Error.&quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">, </span><span class="s1">msg</span><span class="s0">, </span><span class="s1">doc</span><span class="s0">, </span><span class="s1">pos):</span>
        <span class="s1">lineno = doc.count(</span><span class="s4">'</span><span class="s0">\n</span><span class="s4">'</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s1">pos) + </span><span class="s2">1</span>
        <span class="s1">colno = pos - doc.rfind(</span><span class="s4">'</span><span class="s0">\n</span><span class="s4">'</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s1">pos)</span>
        <span class="s1">emsg = </span><span class="s4">'{} (line {} column {} char {})'</span><span class="s1">.format(msg</span><span class="s0">, </span><span class="s1">lineno</span><span class="s0">, </span><span class="s1">colno</span><span class="s0">, </span><span class="s1">pos)</span>
        <span class="s1">ValueError.__init__(self</span><span class="s0">, </span><span class="s1">emsg)</span>
        <span class="s1">self.msg = msg</span>
        <span class="s1">self.doc = doc</span>
        <span class="s1">self.pos = pos</span>
        <span class="s1">self.lineno = lineno</span>
        <span class="s1">self.colno = colno</span>


<span class="s3"># Matches a TOML number, which allows underscores for readability</span>
<span class="s1">_number_with_underscores = re.compile(</span><span class="s4">'([0-9])(_([0-9]))*'</span><span class="s1">)</span>


<span class="s0">class </span><span class="s1">CommentValue(object):</span>
    <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">, </span><span class="s1">val</span><span class="s0">, </span><span class="s1">comment</span><span class="s0">, </span><span class="s1">beginline</span><span class="s0">, </span><span class="s1">_dict):</span>
        <span class="s1">self.val = val</span>
        <span class="s1">separator = </span><span class="s4">&quot;</span><span class="s0">\n</span><span class="s4">&quot; </span><span class="s0">if </span><span class="s1">beginline </span><span class="s0">else </span><span class="s4">&quot; &quot;</span>
        <span class="s1">self.comment = separator + comment</span>
        <span class="s1">self._dict = _dict</span>

    <span class="s0">def </span><span class="s1">__getitem__(self</span><span class="s0">, </span><span class="s1">key):</span>
        <span class="s0">return </span><span class="s1">self.val[key]</span>

    <span class="s0">def </span><span class="s1">__setitem__(self</span><span class="s0">, </span><span class="s1">key</span><span class="s0">, </span><span class="s1">value):</span>
        <span class="s1">self.val[key] = value</span>

    <span class="s0">def </span><span class="s1">dump(self</span><span class="s0">, </span><span class="s1">dump_value_func):</span>
        <span class="s1">retstr = dump_value_func(self.val)</span>
        <span class="s0">if </span><span class="s1">isinstance(self.val</span><span class="s0">, </span><span class="s1">self._dict):</span>
            <span class="s0">return </span><span class="s1">self.comment + </span><span class="s4">&quot;</span><span class="s0">\n</span><span class="s4">&quot; </span><span class="s1">+ unicode(retstr)</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s0">return </span><span class="s1">unicode(retstr) + self.comment</span>


<span class="s0">def </span><span class="s1">_strictly_valid_num(n):</span>
    <span class="s1">n = n.strip()</span>
    <span class="s0">if not </span><span class="s1">n:</span>
        <span class="s0">return False</span>
    <span class="s0">if </span><span class="s1">n[</span><span class="s2">0</span><span class="s1">] == </span><span class="s4">'_'</span><span class="s1">:</span>
        <span class="s0">return False</span>
    <span class="s0">if </span><span class="s1">n[-</span><span class="s2">1</span><span class="s1">] == </span><span class="s4">'_'</span><span class="s1">:</span>
        <span class="s0">return False</span>
    <span class="s0">if </span><span class="s4">&quot;_.&quot; </span><span class="s0">in </span><span class="s1">n </span><span class="s0">or </span><span class="s4">&quot;._&quot; </span><span class="s0">in </span><span class="s1">n:</span>
        <span class="s0">return False</span>
    <span class="s0">if </span><span class="s1">len(n) == </span><span class="s2">1</span><span class="s1">:</span>
        <span class="s0">return True</span>
    <span class="s0">if </span><span class="s1">n[</span><span class="s2">0</span><span class="s1">] == </span><span class="s4">'0' </span><span class="s0">and </span><span class="s1">n[</span><span class="s2">1</span><span class="s1">] </span><span class="s0">not in </span><span class="s1">[</span><span class="s4">'.'</span><span class="s0">, </span><span class="s4">'o'</span><span class="s0">, </span><span class="s4">'b'</span><span class="s0">, </span><span class="s4">'x'</span><span class="s1">]:</span>
        <span class="s0">return False</span>
    <span class="s0">if </span><span class="s1">n[</span><span class="s2">0</span><span class="s1">] == </span><span class="s4">'+' </span><span class="s0">or </span><span class="s1">n[</span><span class="s2">0</span><span class="s1">] == </span><span class="s4">'-'</span><span class="s1">:</span>
        <span class="s1">n = n[</span><span class="s2">1</span><span class="s1">:]</span>
        <span class="s0">if </span><span class="s1">len(n) &gt; </span><span class="s2">1 </span><span class="s0">and </span><span class="s1">n[</span><span class="s2">0</span><span class="s1">] == </span><span class="s4">'0' </span><span class="s0">and </span><span class="s1">n[</span><span class="s2">1</span><span class="s1">] != </span><span class="s4">'.'</span><span class="s1">:</span>
            <span class="s0">return False</span>
    <span class="s0">if </span><span class="s4">'__' </span><span class="s0">in </span><span class="s1">n:</span>
        <span class="s0">return False</span>
    <span class="s0">return True</span>


<span class="s0">def </span><span class="s1">load(f</span><span class="s0">, </span><span class="s1">_dict=dict</span><span class="s0">, </span><span class="s1">decoder=</span><span class="s0">None</span><span class="s1">):</span>
    <span class="s5">&quot;&quot;&quot;Parses named file or files as toml and returns a dictionary 
 
    Args: 
        f: Path to the file to open, array of files to read into single dict 
           or a file descriptor 
        _dict: (optional) Specifies the class of the returned toml dictionary 
        decoder: The decoder to use 
 
    Returns: 
        Parsed toml file represented as a dictionary 
 
    Raises: 
        TypeError -- When f is invalid type 
        TomlDecodeError: Error while decoding toml 
        IOError / FileNotFoundError -- When an array with no valid (existing) 
        (Python 2 / Python 3)          file paths is passed 
    &quot;&quot;&quot;</span>

    <span class="s0">if </span><span class="s1">_ispath(f):</span>
        <span class="s0">with </span><span class="s1">io.open(_getpath(f)</span><span class="s0">, </span><span class="s1">encoding=</span><span class="s4">'utf-8'</span><span class="s1">) </span><span class="s0">as </span><span class="s1">ffile:</span>
            <span class="s0">return </span><span class="s1">loads(ffile.read()</span><span class="s0">, </span><span class="s1">_dict</span><span class="s0">, </span><span class="s1">decoder)</span>
    <span class="s0">elif </span><span class="s1">isinstance(f</span><span class="s0">, </span><span class="s1">list):</span>
        <span class="s0">from </span><span class="s1">os </span><span class="s0">import </span><span class="s1">path </span><span class="s0">as </span><span class="s1">op</span>
        <span class="s0">from </span><span class="s1">warnings </span><span class="s0">import </span><span class="s1">warn</span>
        <span class="s0">if not </span><span class="s1">[path </span><span class="s0">for </span><span class="s1">path </span><span class="s0">in </span><span class="s1">f </span><span class="s0">if </span><span class="s1">op.exists(path)]:</span>
            <span class="s1">error_msg = </span><span class="s4">&quot;Load expects a list to contain filenames only.&quot;</span>
            <span class="s1">error_msg += linesep</span>
            <span class="s1">error_msg += (</span><span class="s4">&quot;The list needs to contain the path of at least one &quot;</span>
                          <span class="s4">&quot;existing file.&quot;</span><span class="s1">)</span>
            <span class="s0">raise </span><span class="s1">FNFError(error_msg)</span>
        <span class="s0">if </span><span class="s1">decoder </span><span class="s0">is None</span><span class="s1">:</span>
            <span class="s1">decoder = TomlDecoder(_dict)</span>
        <span class="s1">d = decoder.get_empty_table()</span>
        <span class="s0">for </span><span class="s1">l </span><span class="s0">in </span><span class="s1">f:  </span><span class="s3"># noqa: E741</span>
            <span class="s0">if </span><span class="s1">op.exists(l):</span>
                <span class="s1">d.update(load(l</span><span class="s0">, </span><span class="s1">_dict</span><span class="s0">, </span><span class="s1">decoder))</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s1">warn(</span><span class="s4">&quot;Non-existent filename in list with at least one valid &quot;</span>
                     <span class="s4">&quot;filename&quot;</span><span class="s1">)</span>
        <span class="s0">return </span><span class="s1">d</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s0">try</span><span class="s1">:</span>
            <span class="s0">return </span><span class="s1">loads(f.read()</span><span class="s0">, </span><span class="s1">_dict</span><span class="s0">, </span><span class="s1">decoder)</span>
        <span class="s0">except </span><span class="s1">AttributeError:</span>
            <span class="s0">raise </span><span class="s1">TypeError(</span><span class="s4">&quot;You can only load a file descriptor, filename or &quot;</span>
                            <span class="s4">&quot;list&quot;</span><span class="s1">)</span>


<span class="s1">_groupname_re = re.compile(</span><span class="s4">r'^[A-Za-z0-9_-]+$'</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">loads(s</span><span class="s0">, </span><span class="s1">_dict=dict</span><span class="s0">, </span><span class="s1">decoder=</span><span class="s0">None</span><span class="s1">):</span>
    <span class="s5">&quot;&quot;&quot;Parses string as toml 
 
    Args: 
        s: String to be parsed 
        _dict: (optional) Specifies the class of the returned toml dictionary 
 
    Returns: 
        Parsed toml file represented as a dictionary 
 
    Raises: 
        TypeError: When a non-string is passed 
        TomlDecodeError: Error while decoding toml 
    &quot;&quot;&quot;</span>

    <span class="s1">implicitgroups = []</span>
    <span class="s0">if </span><span class="s1">decoder </span><span class="s0">is None</span><span class="s1">:</span>
        <span class="s1">decoder = TomlDecoder(_dict)</span>
    <span class="s1">retval = decoder.get_empty_table()</span>
    <span class="s1">currentlevel = retval</span>
    <span class="s0">if not </span><span class="s1">isinstance(s</span><span class="s0">, </span><span class="s1">basestring):</span>
        <span class="s0">raise </span><span class="s1">TypeError(</span><span class="s4">&quot;Expecting something like a string&quot;</span><span class="s1">)</span>

    <span class="s0">if not </span><span class="s1">isinstance(s</span><span class="s0">, </span><span class="s1">unicode):</span>
        <span class="s1">s = s.decode(</span><span class="s4">'utf8'</span><span class="s1">)</span>

    <span class="s1">original = s</span>
    <span class="s1">sl = list(s)</span>
    <span class="s1">openarr = </span><span class="s2">0</span>
    <span class="s1">openstring = </span><span class="s0">False</span>
    <span class="s1">openstrchar = </span><span class="s4">&quot;&quot;</span>
    <span class="s1">multilinestr = </span><span class="s0">False</span>
    <span class="s1">arrayoftables = </span><span class="s0">False</span>
    <span class="s1">beginline = </span><span class="s0">True</span>
    <span class="s1">keygroup = </span><span class="s0">False</span>
    <span class="s1">dottedkey = </span><span class="s0">False</span>
    <span class="s1">keyname = </span><span class="s2">0</span>
    <span class="s1">key = </span><span class="s4">''</span>
    <span class="s1">prev_key = </span><span class="s4">''</span>
    <span class="s1">line_no = </span><span class="s2">1</span>

    <span class="s0">for </span><span class="s1">i</span><span class="s0">, </span><span class="s1">item </span><span class="s0">in </span><span class="s1">enumerate(sl):</span>
        <span class="s0">if </span><span class="s1">item == </span><span class="s4">'</span><span class="s0">\r</span><span class="s4">' </span><span class="s0">and </span><span class="s1">sl[i + </span><span class="s2">1</span><span class="s1">] == </span><span class="s4">'</span><span class="s0">\n</span><span class="s4">'</span><span class="s1">:</span>
            <span class="s1">sl[i] = </span><span class="s4">' '</span>
            <span class="s0">continue</span>
        <span class="s0">if </span><span class="s1">keyname:</span>
            <span class="s1">key += item</span>
            <span class="s0">if </span><span class="s1">item == </span><span class="s4">'</span><span class="s0">\n</span><span class="s4">'</span><span class="s1">:</span>
                <span class="s0">raise </span><span class="s1">TomlDecodeError(</span><span class="s4">&quot;Key name found without value.&quot;</span>
                                      <span class="s4">&quot; Reached end of line.&quot;</span><span class="s0">, </span><span class="s1">original</span><span class="s0">, </span><span class="s1">i)</span>
            <span class="s0">if </span><span class="s1">openstring:</span>
                <span class="s0">if </span><span class="s1">item == openstrchar:</span>
                    <span class="s1">oddbackslash = </span><span class="s0">False</span>
                    <span class="s1">k = </span><span class="s2">1</span>
                    <span class="s0">while </span><span class="s1">i &gt;= k </span><span class="s0">and </span><span class="s1">sl[i - k] == </span><span class="s4">'</span><span class="s0">\\</span><span class="s4">'</span><span class="s1">:</span>
                        <span class="s1">oddbackslash = </span><span class="s0">not </span><span class="s1">oddbackslash</span>
                        <span class="s1">k += </span><span class="s2">1</span>
                    <span class="s0">if not </span><span class="s1">oddbackslash:</span>
                        <span class="s1">keyname = </span><span class="s2">2</span>
                        <span class="s1">openstring = </span><span class="s0">False</span>
                        <span class="s1">openstrchar = </span><span class="s4">&quot;&quot;</span>
                <span class="s0">continue</span>
            <span class="s0">elif </span><span class="s1">keyname == </span><span class="s2">1</span><span class="s1">:</span>
                <span class="s0">if </span><span class="s1">item.isspace():</span>
                    <span class="s1">keyname = </span><span class="s2">2</span>
                    <span class="s0">continue</span>
                <span class="s0">elif </span><span class="s1">item == </span><span class="s4">'.'</span><span class="s1">:</span>
                    <span class="s1">dottedkey = </span><span class="s0">True</span>
                    <span class="s0">continue</span>
                <span class="s0">elif </span><span class="s1">item.isalnum() </span><span class="s0">or </span><span class="s1">item == </span><span class="s4">'_' </span><span class="s0">or </span><span class="s1">item == </span><span class="s4">'-'</span><span class="s1">:</span>
                    <span class="s0">continue</span>
                <span class="s0">elif </span><span class="s1">(dottedkey </span><span class="s0">and </span><span class="s1">sl[i - </span><span class="s2">1</span><span class="s1">] == </span><span class="s4">'.' </span><span class="s0">and</span>
                      <span class="s1">(item == </span><span class="s4">'&quot;' </span><span class="s0">or </span><span class="s1">item == </span><span class="s4">&quot;'&quot;</span><span class="s1">)):</span>
                    <span class="s1">openstring = </span><span class="s0">True</span>
                    <span class="s1">openstrchar = item</span>
                    <span class="s0">continue</span>
            <span class="s0">elif </span><span class="s1">keyname == </span><span class="s2">2</span><span class="s1">:</span>
                <span class="s0">if </span><span class="s1">item.isspace():</span>
                    <span class="s0">if </span><span class="s1">dottedkey:</span>
                        <span class="s1">nextitem = sl[i + </span><span class="s2">1</span><span class="s1">]</span>
                        <span class="s0">if not </span><span class="s1">nextitem.isspace() </span><span class="s0">and </span><span class="s1">nextitem != </span><span class="s4">'.'</span><span class="s1">:</span>
                            <span class="s1">keyname = </span><span class="s2">1</span>
                    <span class="s0">continue</span>
                <span class="s0">if </span><span class="s1">item == </span><span class="s4">'.'</span><span class="s1">:</span>
                    <span class="s1">dottedkey = </span><span class="s0">True</span>
                    <span class="s1">nextitem = sl[i + </span><span class="s2">1</span><span class="s1">]</span>
                    <span class="s0">if not </span><span class="s1">nextitem.isspace() </span><span class="s0">and </span><span class="s1">nextitem != </span><span class="s4">'.'</span><span class="s1">:</span>
                        <span class="s1">keyname = </span><span class="s2">1</span>
                    <span class="s0">continue</span>
            <span class="s0">if </span><span class="s1">item == </span><span class="s4">'='</span><span class="s1">:</span>
                <span class="s1">keyname = </span><span class="s2">0</span>
                <span class="s1">prev_key = key[:-</span><span class="s2">1</span><span class="s1">].rstrip()</span>
                <span class="s1">key = </span><span class="s4">''</span>
                <span class="s1">dottedkey = </span><span class="s0">False</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s0">raise </span><span class="s1">TomlDecodeError(</span><span class="s4">&quot;Found invalid character in key name: '&quot; </span><span class="s1">+</span>
                                      <span class="s1">item + </span><span class="s4">&quot;'. Try quoting the key name.&quot;</span><span class="s0">,</span>
                                      <span class="s1">original</span><span class="s0">, </span><span class="s1">i)</span>
        <span class="s0">if </span><span class="s1">item == </span><span class="s4">&quot;'&quot; </span><span class="s0">and </span><span class="s1">openstrchar != </span><span class="s4">'&quot;'</span><span class="s1">:</span>
            <span class="s1">k = </span><span class="s2">1</span>
            <span class="s0">try</span><span class="s1">:</span>
                <span class="s0">while </span><span class="s1">sl[i - k] == </span><span class="s4">&quot;'&quot;</span><span class="s1">:</span>
                    <span class="s1">k += </span><span class="s2">1</span>
                    <span class="s0">if </span><span class="s1">k == </span><span class="s2">3</span><span class="s1">:</span>
                        <span class="s0">break</span>
            <span class="s0">except </span><span class="s1">IndexError:</span>
                <span class="s0">pass</span>
            <span class="s0">if </span><span class="s1">k == </span><span class="s2">3</span><span class="s1">:</span>
                <span class="s1">multilinestr = </span><span class="s0">not </span><span class="s1">multilinestr</span>
                <span class="s1">openstring = multilinestr</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s1">openstring = </span><span class="s0">not </span><span class="s1">openstring</span>
            <span class="s0">if </span><span class="s1">openstring:</span>
                <span class="s1">openstrchar = </span><span class="s4">&quot;'&quot;</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s1">openstrchar = </span><span class="s4">&quot;&quot;</span>
        <span class="s0">if </span><span class="s1">item == </span><span class="s4">'&quot;' </span><span class="s0">and </span><span class="s1">openstrchar != </span><span class="s4">&quot;'&quot;</span><span class="s1">:</span>
            <span class="s1">oddbackslash = </span><span class="s0">False</span>
            <span class="s1">k = </span><span class="s2">1</span>
            <span class="s1">tripquote = </span><span class="s0">False</span>
            <span class="s0">try</span><span class="s1">:</span>
                <span class="s0">while </span><span class="s1">sl[i - k] == </span><span class="s4">'&quot;'</span><span class="s1">:</span>
                    <span class="s1">k += </span><span class="s2">1</span>
                    <span class="s0">if </span><span class="s1">k == </span><span class="s2">3</span><span class="s1">:</span>
                        <span class="s1">tripquote = </span><span class="s0">True</span>
                        <span class="s0">break</span>
                <span class="s0">if </span><span class="s1">k == </span><span class="s2">1 </span><span class="s0">or </span><span class="s1">(k == </span><span class="s2">3 </span><span class="s0">and </span><span class="s1">tripquote):</span>
                    <span class="s0">while </span><span class="s1">sl[i - k] == </span><span class="s4">'</span><span class="s0">\\</span><span class="s4">'</span><span class="s1">:</span>
                        <span class="s1">oddbackslash = </span><span class="s0">not </span><span class="s1">oddbackslash</span>
                        <span class="s1">k += </span><span class="s2">1</span>
            <span class="s0">except </span><span class="s1">IndexError:</span>
                <span class="s0">pass</span>
            <span class="s0">if not </span><span class="s1">oddbackslash:</span>
                <span class="s0">if </span><span class="s1">tripquote:</span>
                    <span class="s1">multilinestr = </span><span class="s0">not </span><span class="s1">multilinestr</span>
                    <span class="s1">openstring = multilinestr</span>
                <span class="s0">else</span><span class="s1">:</span>
                    <span class="s1">openstring = </span><span class="s0">not </span><span class="s1">openstring</span>
            <span class="s0">if </span><span class="s1">openstring:</span>
                <span class="s1">openstrchar = </span><span class="s4">'&quot;'</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s1">openstrchar = </span><span class="s4">&quot;&quot;</span>
        <span class="s0">if </span><span class="s1">item == </span><span class="s4">'#' </span><span class="s0">and </span><span class="s1">(</span><span class="s0">not </span><span class="s1">openstring </span><span class="s0">and not </span><span class="s1">keygroup </span><span class="s0">and</span>
                            <span class="s0">not </span><span class="s1">arrayoftables):</span>
            <span class="s1">j = i</span>
            <span class="s1">comment = </span><span class="s4">&quot;&quot;</span>
            <span class="s0">try</span><span class="s1">:</span>
                <span class="s0">while </span><span class="s1">sl[j] != </span><span class="s4">'</span><span class="s0">\n</span><span class="s4">'</span><span class="s1">:</span>
                    <span class="s1">comment += s[j]</span>
                    <span class="s1">sl[j] = </span><span class="s4">' '</span>
                    <span class="s1">j += </span><span class="s2">1</span>
            <span class="s0">except </span><span class="s1">IndexError:</span>
                <span class="s0">break</span>
            <span class="s0">if not </span><span class="s1">openarr:</span>
                <span class="s1">decoder.preserve_comment(line_no</span><span class="s0">, </span><span class="s1">prev_key</span><span class="s0">, </span><span class="s1">comment</span><span class="s0">, </span><span class="s1">beginline)</span>
        <span class="s0">if </span><span class="s1">item == </span><span class="s4">'[' </span><span class="s0">and </span><span class="s1">(</span><span class="s0">not </span><span class="s1">openstring </span><span class="s0">and not </span><span class="s1">keygroup </span><span class="s0">and</span>
                            <span class="s0">not </span><span class="s1">arrayoftables):</span>
            <span class="s0">if </span><span class="s1">beginline:</span>
                <span class="s0">if </span><span class="s1">len(sl) &gt; i + </span><span class="s2">1 </span><span class="s0">and </span><span class="s1">sl[i + </span><span class="s2">1</span><span class="s1">] == </span><span class="s4">'['</span><span class="s1">:</span>
                    <span class="s1">arrayoftables = </span><span class="s0">True</span>
                <span class="s0">else</span><span class="s1">:</span>
                    <span class="s1">keygroup = </span><span class="s0">True</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s1">openarr += </span><span class="s2">1</span>
        <span class="s0">if </span><span class="s1">item == </span><span class="s4">']' </span><span class="s0">and not </span><span class="s1">openstring:</span>
            <span class="s0">if </span><span class="s1">keygroup:</span>
                <span class="s1">keygroup = </span><span class="s0">False</span>
            <span class="s0">elif </span><span class="s1">arrayoftables:</span>
                <span class="s0">if </span><span class="s1">sl[i - </span><span class="s2">1</span><span class="s1">] == </span><span class="s4">']'</span><span class="s1">:</span>
                    <span class="s1">arrayoftables = </span><span class="s0">False</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s1">openarr -= </span><span class="s2">1</span>
        <span class="s0">if </span><span class="s1">item == </span><span class="s4">'</span><span class="s0">\n</span><span class="s4">'</span><span class="s1">:</span>
            <span class="s0">if </span><span class="s1">openstring </span><span class="s0">or </span><span class="s1">multilinestr:</span>
                <span class="s0">if not </span><span class="s1">multilinestr:</span>
                    <span class="s0">raise </span><span class="s1">TomlDecodeError(</span><span class="s4">&quot;Unbalanced quotes&quot;</span><span class="s0">, </span><span class="s1">original</span><span class="s0">, </span><span class="s1">i)</span>
                <span class="s0">if </span><span class="s1">((sl[i - </span><span class="s2">1</span><span class="s1">] == </span><span class="s4">&quot;'&quot; </span><span class="s0">or </span><span class="s1">sl[i - </span><span class="s2">1</span><span class="s1">] == </span><span class="s4">'&quot;'</span><span class="s1">) </span><span class="s0">and </span><span class="s1">(</span>
                        <span class="s1">sl[i - </span><span class="s2">2</span><span class="s1">] == sl[i - </span><span class="s2">1</span><span class="s1">])):</span>
                    <span class="s1">sl[i] = sl[i - </span><span class="s2">1</span><span class="s1">]</span>
                    <span class="s0">if </span><span class="s1">sl[i - </span><span class="s2">3</span><span class="s1">] == sl[i - </span><span class="s2">1</span><span class="s1">]:</span>
                        <span class="s1">sl[i - </span><span class="s2">3</span><span class="s1">] = </span><span class="s4">' '</span>
            <span class="s0">elif </span><span class="s1">openarr:</span>
                <span class="s1">sl[i] = </span><span class="s4">' '</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s1">beginline = </span><span class="s0">True</span>
            <span class="s1">line_no += </span><span class="s2">1</span>
        <span class="s0">elif </span><span class="s1">beginline </span><span class="s0">and </span><span class="s1">sl[i] != </span><span class="s4">' ' </span><span class="s0">and </span><span class="s1">sl[i] != </span><span class="s4">'</span><span class="s0">\t</span><span class="s4">'</span><span class="s1">:</span>
            <span class="s1">beginline = </span><span class="s0">False</span>
            <span class="s0">if not </span><span class="s1">keygroup </span><span class="s0">and not </span><span class="s1">arrayoftables:</span>
                <span class="s0">if </span><span class="s1">sl[i] == </span><span class="s4">'='</span><span class="s1">:</span>
                    <span class="s0">raise </span><span class="s1">TomlDecodeError(</span><span class="s4">&quot;Found empty keyname. &quot;</span><span class="s0">, </span><span class="s1">original</span><span class="s0">, </span><span class="s1">i)</span>
                <span class="s1">keyname = </span><span class="s2">1</span>
                <span class="s1">key += item</span>
    <span class="s0">if </span><span class="s1">keyname:</span>
        <span class="s0">raise </span><span class="s1">TomlDecodeError(</span><span class="s4">&quot;Key name found without value.&quot;</span>
                              <span class="s4">&quot; Reached end of file.&quot;</span><span class="s0">, </span><span class="s1">original</span><span class="s0">, </span><span class="s1">len(s))</span>
    <span class="s0">if </span><span class="s1">openstring:  </span><span class="s3"># reached EOF and have an unterminated string</span>
        <span class="s0">raise </span><span class="s1">TomlDecodeError(</span><span class="s4">&quot;Unterminated string found.&quot;</span>
                              <span class="s4">&quot; Reached end of file.&quot;</span><span class="s0">, </span><span class="s1">original</span><span class="s0">, </span><span class="s1">len(s))</span>
    <span class="s1">s = </span><span class="s4">''</span><span class="s1">.join(sl)</span>
    <span class="s1">s = s.split(</span><span class="s4">'</span><span class="s0">\n</span><span class="s4">'</span><span class="s1">)</span>
    <span class="s1">multikey = </span><span class="s0">None</span>
    <span class="s1">multilinestr = </span><span class="s4">&quot;&quot;</span>
    <span class="s1">multibackslash = </span><span class="s0">False</span>
    <span class="s1">pos = </span><span class="s2">0</span>
    <span class="s0">for </span><span class="s1">idx</span><span class="s0">, </span><span class="s1">line </span><span class="s0">in </span><span class="s1">enumerate(s):</span>
        <span class="s0">if </span><span class="s1">idx &gt; </span><span class="s2">0</span><span class="s1">:</span>
            <span class="s1">pos += len(s[idx - </span><span class="s2">1</span><span class="s1">]) + </span><span class="s2">1</span>

        <span class="s1">decoder.embed_comments(idx</span><span class="s0">, </span><span class="s1">currentlevel)</span>

        <span class="s0">if not </span><span class="s1">multilinestr </span><span class="s0">or </span><span class="s1">multibackslash </span><span class="s0">or </span><span class="s4">'</span><span class="s0">\n</span><span class="s4">' </span><span class="s0">not in </span><span class="s1">multilinestr:</span>
            <span class="s1">line = line.strip()</span>
        <span class="s0">if </span><span class="s1">line == </span><span class="s4">&quot;&quot; </span><span class="s0">and </span><span class="s1">(</span><span class="s0">not </span><span class="s1">multikey </span><span class="s0">or </span><span class="s1">multibackslash):</span>
            <span class="s0">continue</span>
        <span class="s0">if </span><span class="s1">multikey:</span>
            <span class="s0">if </span><span class="s1">multibackslash:</span>
                <span class="s1">multilinestr += line</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s1">multilinestr += line</span>
            <span class="s1">multibackslash = </span><span class="s0">False</span>
            <span class="s1">closed = </span><span class="s0">False</span>
            <span class="s0">if </span><span class="s1">multilinestr[</span><span class="s2">0</span><span class="s1">] == </span><span class="s4">'['</span><span class="s1">:</span>
                <span class="s1">closed = line[-</span><span class="s2">1</span><span class="s1">] == </span><span class="s4">']'</span>
            <span class="s0">elif </span><span class="s1">len(line) &gt; </span><span class="s2">2</span><span class="s1">:</span>
                <span class="s1">closed = (line[-</span><span class="s2">1</span><span class="s1">] == multilinestr[</span><span class="s2">0</span><span class="s1">] </span><span class="s0">and</span>
                          <span class="s1">line[-</span><span class="s2">2</span><span class="s1">] == multilinestr[</span><span class="s2">0</span><span class="s1">] </span><span class="s0">and</span>
                          <span class="s1">line[-</span><span class="s2">3</span><span class="s1">] == multilinestr[</span><span class="s2">0</span><span class="s1">])</span>
            <span class="s0">if </span><span class="s1">closed:</span>
                <span class="s0">try</span><span class="s1">:</span>
                    <span class="s1">value</span><span class="s0">, </span><span class="s1">vtype = decoder.load_value(multilinestr)</span>
                <span class="s0">except </span><span class="s1">ValueError </span><span class="s0">as </span><span class="s1">err:</span>
                    <span class="s0">raise </span><span class="s1">TomlDecodeError(str(err)</span><span class="s0">, </span><span class="s1">original</span><span class="s0">, </span><span class="s1">pos)</span>
                <span class="s1">currentlevel[multikey] = value</span>
                <span class="s1">multikey = </span><span class="s0">None</span>
                <span class="s1">multilinestr = </span><span class="s4">&quot;&quot;</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s1">k = len(multilinestr) - </span><span class="s2">1</span>
                <span class="s0">while </span><span class="s1">k &gt; -</span><span class="s2">1 </span><span class="s0">and </span><span class="s1">multilinestr[k] == </span><span class="s4">'</span><span class="s0">\\</span><span class="s4">'</span><span class="s1">:</span>
                    <span class="s1">multibackslash = </span><span class="s0">not </span><span class="s1">multibackslash</span>
                    <span class="s1">k -= </span><span class="s2">1</span>
                <span class="s0">if </span><span class="s1">multibackslash:</span>
                    <span class="s1">multilinestr = multilinestr[:-</span><span class="s2">1</span><span class="s1">]</span>
                <span class="s0">else</span><span class="s1">:</span>
                    <span class="s1">multilinestr += </span><span class="s4">&quot;</span><span class="s0">\n</span><span class="s4">&quot;</span>
            <span class="s0">continue</span>
        <span class="s0">if </span><span class="s1">line[</span><span class="s2">0</span><span class="s1">] == </span><span class="s4">'['</span><span class="s1">:</span>
            <span class="s1">arrayoftables = </span><span class="s0">False</span>
            <span class="s0">if </span><span class="s1">len(line) == </span><span class="s2">1</span><span class="s1">:</span>
                <span class="s0">raise </span><span class="s1">TomlDecodeError(</span><span class="s4">&quot;Opening key group bracket on line by &quot;</span>
                                      <span class="s4">&quot;itself.&quot;</span><span class="s0">, </span><span class="s1">original</span><span class="s0">, </span><span class="s1">pos)</span>
            <span class="s0">if </span><span class="s1">line[</span><span class="s2">1</span><span class="s1">] == </span><span class="s4">'['</span><span class="s1">:</span>
                <span class="s1">arrayoftables = </span><span class="s0">True</span>
                <span class="s1">line = line[</span><span class="s2">2</span><span class="s1">:]</span>
                <span class="s1">splitstr = </span><span class="s4">']]'</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s1">line = line[</span><span class="s2">1</span><span class="s1">:]</span>
                <span class="s1">splitstr = </span><span class="s4">']'</span>
            <span class="s1">i = </span><span class="s2">1</span>
            <span class="s1">quotesplits = decoder._get_split_on_quotes(line)</span>
            <span class="s1">quoted = </span><span class="s0">False</span>
            <span class="s0">for </span><span class="s1">quotesplit </span><span class="s0">in </span><span class="s1">quotesplits:</span>
                <span class="s0">if not </span><span class="s1">quoted </span><span class="s0">and </span><span class="s1">splitstr </span><span class="s0">in </span><span class="s1">quotesplit:</span>
                    <span class="s0">break</span>
                <span class="s1">i += quotesplit.count(splitstr)</span>
                <span class="s1">quoted = </span><span class="s0">not </span><span class="s1">quoted</span>
            <span class="s1">line = line.split(splitstr</span><span class="s0">, </span><span class="s1">i)</span>
            <span class="s0">if </span><span class="s1">len(line) &lt; i + </span><span class="s2">1 </span><span class="s0">or </span><span class="s1">line[-</span><span class="s2">1</span><span class="s1">].strip() != </span><span class="s4">&quot;&quot;</span><span class="s1">:</span>
                <span class="s0">raise </span><span class="s1">TomlDecodeError(</span><span class="s4">&quot;Key group not on a line by itself.&quot;</span><span class="s0">,</span>
                                      <span class="s1">original</span><span class="s0">, </span><span class="s1">pos)</span>
            <span class="s1">groups = splitstr.join(line[:-</span><span class="s2">1</span><span class="s1">]).split(</span><span class="s4">'.'</span><span class="s1">)</span>
            <span class="s1">i = </span><span class="s2">0</span>
            <span class="s0">while </span><span class="s1">i &lt; len(groups):</span>
                <span class="s1">groups[i] = groups[i].strip()</span>
                <span class="s0">if </span><span class="s1">len(groups[i]) &gt; </span><span class="s2">0 </span><span class="s0">and </span><span class="s1">(groups[i][</span><span class="s2">0</span><span class="s1">] == </span><span class="s4">'&quot;' </span><span class="s0">or</span>
                                           <span class="s1">groups[i][</span><span class="s2">0</span><span class="s1">] == </span><span class="s4">&quot;'&quot;</span><span class="s1">):</span>
                    <span class="s1">groupstr = groups[i]</span>
                    <span class="s1">j = i + </span><span class="s2">1</span>
                    <span class="s0">while </span><span class="s1">((</span><span class="s0">not </span><span class="s1">groupstr[</span><span class="s2">0</span><span class="s1">] == groupstr[-</span><span class="s2">1</span><span class="s1">]) </span><span class="s0">or</span>
                           <span class="s1">len(groupstr) == </span><span class="s2">1</span><span class="s1">):</span>
                        <span class="s1">j += </span><span class="s2">1</span>
                        <span class="s0">if </span><span class="s1">j &gt; len(groups) + </span><span class="s2">2</span><span class="s1">:</span>
                            <span class="s0">raise </span><span class="s1">TomlDecodeError(</span><span class="s4">&quot;Invalid group name '&quot; </span><span class="s1">+</span>
                                                  <span class="s1">groupstr + </span><span class="s4">&quot;' Something &quot; </span><span class="s1">+</span>
                                                  <span class="s4">&quot;went wrong.&quot;</span><span class="s0">, </span><span class="s1">original</span><span class="s0">, </span><span class="s1">pos)</span>
                        <span class="s1">groupstr = </span><span class="s4">'.'</span><span class="s1">.join(groups[i:j]).strip()</span>
                    <span class="s1">groups[i] = groupstr[</span><span class="s2">1</span><span class="s1">:-</span><span class="s2">1</span><span class="s1">]</span>
                    <span class="s1">groups[i + </span><span class="s2">1</span><span class="s1">:j] = []</span>
                <span class="s0">else</span><span class="s1">:</span>
                    <span class="s0">if not </span><span class="s1">_groupname_re.match(groups[i]):</span>
                        <span class="s0">raise </span><span class="s1">TomlDecodeError(</span><span class="s4">&quot;Invalid group name '&quot; </span><span class="s1">+</span>
                                              <span class="s1">groups[i] + </span><span class="s4">&quot;'. Try quoting it.&quot;</span><span class="s0">,</span>
                                              <span class="s1">original</span><span class="s0">, </span><span class="s1">pos)</span>
                <span class="s1">i += </span><span class="s2">1</span>
            <span class="s1">currentlevel = retval</span>
            <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">_range(len(groups)):</span>
                <span class="s1">group = groups[i]</span>
                <span class="s0">if </span><span class="s1">group == </span><span class="s4">&quot;&quot;</span><span class="s1">:</span>
                    <span class="s0">raise </span><span class="s1">TomlDecodeError(</span><span class="s4">&quot;Can't have a keygroup with an empty &quot;</span>
                                          <span class="s4">&quot;name&quot;</span><span class="s0">, </span><span class="s1">original</span><span class="s0">, </span><span class="s1">pos)</span>
                <span class="s0">try</span><span class="s1">:</span>
                    <span class="s1">currentlevel[group]</span>
                    <span class="s0">if </span><span class="s1">i == len(groups) - </span><span class="s2">1</span><span class="s1">:</span>
                        <span class="s0">if </span><span class="s1">group </span><span class="s0">in </span><span class="s1">implicitgroups:</span>
                            <span class="s1">implicitgroups.remove(group)</span>
                            <span class="s0">if </span><span class="s1">arrayoftables:</span>
                                <span class="s0">raise </span><span class="s1">TomlDecodeError(</span><span class="s4">&quot;An implicitly defined &quot;</span>
                                                      <span class="s4">&quot;table can't be an array&quot;</span><span class="s0">,</span>
                                                      <span class="s1">original</span><span class="s0">, </span><span class="s1">pos)</span>
                        <span class="s0">elif </span><span class="s1">arrayoftables:</span>
                            <span class="s1">currentlevel[group].append(decoder.get_empty_table()</span>
                                                       <span class="s1">)</span>
                        <span class="s0">else</span><span class="s1">:</span>
                            <span class="s0">raise </span><span class="s1">TomlDecodeError(</span><span class="s4">&quot;What? &quot; </span><span class="s1">+ group +</span>
                                                  <span class="s4">&quot; already exists?&quot; </span><span class="s1">+</span>
                                                  <span class="s1">str(currentlevel)</span><span class="s0">,</span>
                                                  <span class="s1">original</span><span class="s0">, </span><span class="s1">pos)</span>
                <span class="s0">except </span><span class="s1">TypeError:</span>
                    <span class="s1">currentlevel = currentlevel[-</span><span class="s2">1</span><span class="s1">]</span>
                    <span class="s0">if </span><span class="s1">group </span><span class="s0">not in </span><span class="s1">currentlevel:</span>
                        <span class="s1">currentlevel[group] = decoder.get_empty_table()</span>
                        <span class="s0">if </span><span class="s1">i == len(groups) - </span><span class="s2">1 </span><span class="s0">and </span><span class="s1">arrayoftables:</span>
                            <span class="s1">currentlevel[group] = [decoder.get_empty_table()]</span>
                <span class="s0">except </span><span class="s1">KeyError:</span>
                    <span class="s0">if </span><span class="s1">i != len(groups) - </span><span class="s2">1</span><span class="s1">:</span>
                        <span class="s1">implicitgroups.append(group)</span>
                    <span class="s1">currentlevel[group] = decoder.get_empty_table()</span>
                    <span class="s0">if </span><span class="s1">i == len(groups) - </span><span class="s2">1 </span><span class="s0">and </span><span class="s1">arrayoftables:</span>
                        <span class="s1">currentlevel[group] = [decoder.get_empty_table()]</span>
                <span class="s1">currentlevel = currentlevel[group]</span>
                <span class="s0">if </span><span class="s1">arrayoftables:</span>
                    <span class="s0">try</span><span class="s1">:</span>
                        <span class="s1">currentlevel = currentlevel[-</span><span class="s2">1</span><span class="s1">]</span>
                    <span class="s0">except </span><span class="s1">KeyError:</span>
                        <span class="s0">pass</span>
        <span class="s0">elif </span><span class="s1">line[</span><span class="s2">0</span><span class="s1">] == </span><span class="s4">&quot;{&quot;</span><span class="s1">:</span>
            <span class="s0">if </span><span class="s1">line[-</span><span class="s2">1</span><span class="s1">] != </span><span class="s4">&quot;}&quot;</span><span class="s1">:</span>
                <span class="s0">raise </span><span class="s1">TomlDecodeError(</span><span class="s4">&quot;Line breaks are not allowed in inline&quot;</span>
                                      <span class="s4">&quot;objects&quot;</span><span class="s0">, </span><span class="s1">original</span><span class="s0">, </span><span class="s1">pos)</span>
            <span class="s0">try</span><span class="s1">:</span>
                <span class="s1">decoder.load_inline_object(line</span><span class="s0">, </span><span class="s1">currentlevel</span><span class="s0">, </span><span class="s1">multikey</span><span class="s0">,</span>
                                           <span class="s1">multibackslash)</span>
            <span class="s0">except </span><span class="s1">ValueError </span><span class="s0">as </span><span class="s1">err:</span>
                <span class="s0">raise </span><span class="s1">TomlDecodeError(str(err)</span><span class="s0">, </span><span class="s1">original</span><span class="s0">, </span><span class="s1">pos)</span>
        <span class="s0">elif </span><span class="s4">&quot;=&quot; </span><span class="s0">in </span><span class="s1">line:</span>
            <span class="s0">try</span><span class="s1">:</span>
                <span class="s1">ret = decoder.load_line(line</span><span class="s0">, </span><span class="s1">currentlevel</span><span class="s0">, </span><span class="s1">multikey</span><span class="s0">,</span>
                                        <span class="s1">multibackslash)</span>
            <span class="s0">except </span><span class="s1">ValueError </span><span class="s0">as </span><span class="s1">err:</span>
                <span class="s0">raise </span><span class="s1">TomlDecodeError(str(err)</span><span class="s0">, </span><span class="s1">original</span><span class="s0">, </span><span class="s1">pos)</span>
            <span class="s0">if </span><span class="s1">ret </span><span class="s0">is not None</span><span class="s1">:</span>
                <span class="s1">multikey</span><span class="s0">, </span><span class="s1">multilinestr</span><span class="s0">, </span><span class="s1">multibackslash = ret</span>
    <span class="s0">return </span><span class="s1">retval</span>


<span class="s0">def </span><span class="s1">_load_date(val):</span>
    <span class="s1">microsecond = </span><span class="s2">0</span>
    <span class="s1">tz = </span><span class="s0">None</span>
    <span class="s0">try</span><span class="s1">:</span>
        <span class="s0">if </span><span class="s1">len(val) &gt; </span><span class="s2">19</span><span class="s1">:</span>
            <span class="s0">if </span><span class="s1">val[</span><span class="s2">19</span><span class="s1">] == </span><span class="s4">'.'</span><span class="s1">:</span>
                <span class="s0">if </span><span class="s1">val[-</span><span class="s2">1</span><span class="s1">].upper() == </span><span class="s4">'Z'</span><span class="s1">:</span>
                    <span class="s1">subsecondval = val[</span><span class="s2">20</span><span class="s1">:-</span><span class="s2">1</span><span class="s1">]</span>
                    <span class="s1">tzval = </span><span class="s4">&quot;Z&quot;</span>
                <span class="s0">else</span><span class="s1">:</span>
                    <span class="s1">subsecondvalandtz = val[</span><span class="s2">20</span><span class="s1">:]</span>
                    <span class="s0">if </span><span class="s4">'+' </span><span class="s0">in </span><span class="s1">subsecondvalandtz:</span>
                        <span class="s1">splitpoint = subsecondvalandtz.index(</span><span class="s4">'+'</span><span class="s1">)</span>
                        <span class="s1">subsecondval = subsecondvalandtz[:splitpoint]</span>
                        <span class="s1">tzval = subsecondvalandtz[splitpoint:]</span>
                    <span class="s0">elif </span><span class="s4">'-' </span><span class="s0">in </span><span class="s1">subsecondvalandtz:</span>
                        <span class="s1">splitpoint = subsecondvalandtz.index(</span><span class="s4">'-'</span><span class="s1">)</span>
                        <span class="s1">subsecondval = subsecondvalandtz[:splitpoint]</span>
                        <span class="s1">tzval = subsecondvalandtz[splitpoint:]</span>
                    <span class="s0">else</span><span class="s1">:</span>
                        <span class="s1">tzval = </span><span class="s0">None</span>
                        <span class="s1">subsecondval = subsecondvalandtz</span>
                <span class="s0">if </span><span class="s1">tzval </span><span class="s0">is not None</span><span class="s1">:</span>
                    <span class="s1">tz = TomlTz(tzval)</span>
                <span class="s1">microsecond = int(int(subsecondval) *</span>
                                  <span class="s1">(</span><span class="s2">10 </span><span class="s1">** (</span><span class="s2">6 </span><span class="s1">- len(subsecondval))))</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s1">tz = TomlTz(val[</span><span class="s2">19</span><span class="s1">:])</span>
    <span class="s0">except </span><span class="s1">ValueError:</span>
        <span class="s1">tz = </span><span class="s0">None</span>
    <span class="s0">if </span><span class="s4">&quot;-&quot; </span><span class="s0">not in </span><span class="s1">val[</span><span class="s2">1</span><span class="s1">:]:</span>
        <span class="s0">return None</span>
    <span class="s0">try</span><span class="s1">:</span>
        <span class="s0">if </span><span class="s1">len(val) == </span><span class="s2">10</span><span class="s1">:</span>
            <span class="s1">d = datetime.date(</span>
                <span class="s1">int(val[:</span><span class="s2">4</span><span class="s1">])</span><span class="s0">, </span><span class="s1">int(val[</span><span class="s2">5</span><span class="s1">:</span><span class="s2">7</span><span class="s1">])</span><span class="s0">,</span>
                <span class="s1">int(val[</span><span class="s2">8</span><span class="s1">:</span><span class="s2">10</span><span class="s1">]))</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">d = datetime.datetime(</span>
                <span class="s1">int(val[:</span><span class="s2">4</span><span class="s1">])</span><span class="s0">, </span><span class="s1">int(val[</span><span class="s2">5</span><span class="s1">:</span><span class="s2">7</span><span class="s1">])</span><span class="s0">,</span>
                <span class="s1">int(val[</span><span class="s2">8</span><span class="s1">:</span><span class="s2">10</span><span class="s1">])</span><span class="s0">, </span><span class="s1">int(val[</span><span class="s2">11</span><span class="s1">:</span><span class="s2">13</span><span class="s1">])</span><span class="s0">,</span>
                <span class="s1">int(val[</span><span class="s2">14</span><span class="s1">:</span><span class="s2">16</span><span class="s1">])</span><span class="s0">, </span><span class="s1">int(val[</span><span class="s2">17</span><span class="s1">:</span><span class="s2">19</span><span class="s1">])</span><span class="s0">, </span><span class="s1">microsecond</span><span class="s0">, </span><span class="s1">tz)</span>
    <span class="s0">except </span><span class="s1">ValueError:</span>
        <span class="s0">return None</span>
    <span class="s0">return </span><span class="s1">d</span>


<span class="s0">def </span><span class="s1">_load_unicode_escapes(v</span><span class="s0">, </span><span class="s1">hexbytes</span><span class="s0">, </span><span class="s1">prefix):</span>
    <span class="s1">skip = </span><span class="s0">False</span>
    <span class="s1">i = len(v) - </span><span class="s2">1</span>
    <span class="s0">while </span><span class="s1">i &gt; -</span><span class="s2">1 </span><span class="s0">and </span><span class="s1">v[i] == </span><span class="s4">'</span><span class="s0">\\</span><span class="s4">'</span><span class="s1">:</span>
        <span class="s1">skip = </span><span class="s0">not </span><span class="s1">skip</span>
        <span class="s1">i -= </span><span class="s2">1</span>
    <span class="s0">for </span><span class="s1">hx </span><span class="s0">in </span><span class="s1">hexbytes:</span>
        <span class="s0">if </span><span class="s1">skip:</span>
            <span class="s1">skip = </span><span class="s0">False</span>
            <span class="s1">i = len(hx) - </span><span class="s2">1</span>
            <span class="s0">while </span><span class="s1">i &gt; -</span><span class="s2">1 </span><span class="s0">and </span><span class="s1">hx[i] == </span><span class="s4">'</span><span class="s0">\\</span><span class="s4">'</span><span class="s1">:</span>
                <span class="s1">skip = </span><span class="s0">not </span><span class="s1">skip</span>
                <span class="s1">i -= </span><span class="s2">1</span>
            <span class="s1">v += prefix</span>
            <span class="s1">v += hx</span>
            <span class="s0">continue</span>
        <span class="s1">hxb = </span><span class="s4">&quot;&quot;</span>
        <span class="s1">i = </span><span class="s2">0</span>
        <span class="s1">hxblen = </span><span class="s2">4</span>
        <span class="s0">if </span><span class="s1">prefix == </span><span class="s4">&quot;</span><span class="s0">\\</span><span class="s4">U&quot;</span><span class="s1">:</span>
            <span class="s1">hxblen = </span><span class="s2">8</span>
        <span class="s1">hxb = </span><span class="s4">''</span><span class="s1">.join(hx[i:i + hxblen]).lower()</span>
        <span class="s0">if </span><span class="s1">hxb.strip(</span><span class="s4">'0123456789abcdef'</span><span class="s1">):</span>
            <span class="s0">raise </span><span class="s1">ValueError(</span><span class="s4">&quot;Invalid escape sequence: &quot; </span><span class="s1">+ hxb)</span>
        <span class="s0">if </span><span class="s1">hxb[</span><span class="s2">0</span><span class="s1">] == </span><span class="s4">&quot;d&quot; </span><span class="s0">and </span><span class="s1">hxb[</span><span class="s2">1</span><span class="s1">].strip(</span><span class="s4">'01234567'</span><span class="s1">):</span>
            <span class="s0">raise </span><span class="s1">ValueError(</span><span class="s4">&quot;Invalid escape sequence: &quot; </span><span class="s1">+ hxb +</span>
                             <span class="s4">&quot;. Only scalar unicode points are allowed.&quot;</span><span class="s1">)</span>
        <span class="s1">v += unichr(int(hxb</span><span class="s0">, </span><span class="s2">16</span><span class="s1">))</span>
        <span class="s1">v += unicode(hx[len(hxb):])</span>
    <span class="s0">return </span><span class="s1">v</span>


<span class="s3"># Unescape TOML string values.</span>

<span class="s3"># content after the \</span>
<span class="s1">_escapes = [</span><span class="s4">'0'</span><span class="s0">, </span><span class="s4">'b'</span><span class="s0">, </span><span class="s4">'f'</span><span class="s0">, </span><span class="s4">'n'</span><span class="s0">, </span><span class="s4">'r'</span><span class="s0">, </span><span class="s4">'t'</span><span class="s0">, </span><span class="s4">'&quot;'</span><span class="s1">]</span>
<span class="s3"># What it should be replaced by</span>
<span class="s1">_escapedchars = [</span><span class="s4">'</span><span class="s0">\0</span><span class="s4">'</span><span class="s0">, </span><span class="s4">'</span><span class="s0">\b</span><span class="s4">'</span><span class="s0">, </span><span class="s4">'</span><span class="s0">\f</span><span class="s4">'</span><span class="s0">, </span><span class="s4">'</span><span class="s0">\n</span><span class="s4">'</span><span class="s0">, </span><span class="s4">'</span><span class="s0">\r</span><span class="s4">'</span><span class="s0">, </span><span class="s4">'</span><span class="s0">\t</span><span class="s4">'</span><span class="s0">, </span><span class="s4">'</span><span class="s0">\&quot;</span><span class="s4">'</span><span class="s1">]</span>
<span class="s3"># Used for substitution</span>
<span class="s1">_escape_to_escapedchars = dict(zip(_escapes</span><span class="s0">, </span><span class="s1">_escapedchars))</span>


<span class="s0">def </span><span class="s1">_unescape(v):</span>
    <span class="s5">&quot;&quot;&quot;Unescape characters in a TOML string.&quot;&quot;&quot;</span>
    <span class="s1">i = </span><span class="s2">0</span>
    <span class="s1">backslash = </span><span class="s0">False</span>
    <span class="s0">while </span><span class="s1">i &lt; len(v):</span>
        <span class="s0">if </span><span class="s1">backslash:</span>
            <span class="s1">backslash = </span><span class="s0">False</span>
            <span class="s0">if </span><span class="s1">v[i] </span><span class="s0">in </span><span class="s1">_escapes:</span>
                <span class="s1">v = v[:i - </span><span class="s2">1</span><span class="s1">] + _escape_to_escapedchars[v[i]] + v[i + </span><span class="s2">1</span><span class="s1">:]</span>
            <span class="s0">elif </span><span class="s1">v[i] == </span><span class="s4">'</span><span class="s0">\\</span><span class="s4">'</span><span class="s1">:</span>
                <span class="s1">v = v[:i - </span><span class="s2">1</span><span class="s1">] + v[i:]</span>
            <span class="s0">elif </span><span class="s1">v[i] == </span><span class="s4">'u' </span><span class="s0">or </span><span class="s1">v[i] == </span><span class="s4">'U'</span><span class="s1">:</span>
                <span class="s1">i += </span><span class="s2">1</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s0">raise </span><span class="s1">ValueError(</span><span class="s4">&quot;Reserved escape sequence used&quot;</span><span class="s1">)</span>
            <span class="s0">continue</span>
        <span class="s0">elif </span><span class="s1">v[i] == </span><span class="s4">'</span><span class="s0">\\</span><span class="s4">'</span><span class="s1">:</span>
            <span class="s1">backslash = </span><span class="s0">True</span>
        <span class="s1">i += </span><span class="s2">1</span>
    <span class="s0">return </span><span class="s1">v</span>


<span class="s0">class </span><span class="s1">InlineTableDict(object):</span>
    <span class="s5">&quot;&quot;&quot;Sentinel subclass of dict for inline tables.&quot;&quot;&quot;</span>


<span class="s0">class </span><span class="s1">TomlDecoder(object):</span>

    <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">, </span><span class="s1">_dict=dict):</span>
        <span class="s1">self._dict = _dict</span>

    <span class="s0">def </span><span class="s1">get_empty_table(self):</span>
        <span class="s0">return </span><span class="s1">self._dict()</span>

    <span class="s0">def </span><span class="s1">get_empty_inline_table(self):</span>
        <span class="s0">class </span><span class="s1">DynamicInlineTableDict(self._dict</span><span class="s0">, </span><span class="s1">InlineTableDict):</span>
            <span class="s5">&quot;&quot;&quot;Concrete sentinel subclass for inline tables. 
            It is a subclass of _dict which is passed in dynamically at load 
            time 
 
            It is also a subclass of InlineTableDict 
            &quot;&quot;&quot;</span>

        <span class="s0">return </span><span class="s1">DynamicInlineTableDict()</span>

    <span class="s0">def </span><span class="s1">load_inline_object(self</span><span class="s0">, </span><span class="s1">line</span><span class="s0">, </span><span class="s1">currentlevel</span><span class="s0">, </span><span class="s1">multikey=</span><span class="s0">False,</span>
                           <span class="s1">multibackslash=</span><span class="s0">False</span><span class="s1">):</span>
        <span class="s1">candidate_groups = line[</span><span class="s2">1</span><span class="s1">:-</span><span class="s2">1</span><span class="s1">].split(</span><span class="s4">&quot;,&quot;</span><span class="s1">)</span>
        <span class="s1">groups = []</span>
        <span class="s0">if </span><span class="s1">len(candidate_groups) == </span><span class="s2">1 </span><span class="s0">and not </span><span class="s1">candidate_groups[</span><span class="s2">0</span><span class="s1">].strip():</span>
            <span class="s1">candidate_groups.pop()</span>
        <span class="s0">while </span><span class="s1">len(candidate_groups) &gt; </span><span class="s2">0</span><span class="s1">:</span>
            <span class="s1">candidate_group = candidate_groups.pop(</span><span class="s2">0</span><span class="s1">)</span>
            <span class="s0">try</span><span class="s1">:</span>
                <span class="s1">_</span><span class="s0">, </span><span class="s1">value = candidate_group.split(</span><span class="s4">'='</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
            <span class="s0">except </span><span class="s1">ValueError:</span>
                <span class="s0">raise </span><span class="s1">ValueError(</span><span class="s4">&quot;Invalid inline table encountered&quot;</span><span class="s1">)</span>
            <span class="s1">value = value.strip()</span>
            <span class="s0">if </span><span class="s1">((value[</span><span class="s2">0</span><span class="s1">] == value[-</span><span class="s2">1</span><span class="s1">] </span><span class="s0">and </span><span class="s1">value[</span><span class="s2">0</span><span class="s1">] </span><span class="s0">in </span><span class="s1">(</span><span class="s4">'&quot;'</span><span class="s0">, </span><span class="s4">&quot;'&quot;</span><span class="s1">)) </span><span class="s0">or </span><span class="s1">(</span>
                    <span class="s1">value[</span><span class="s2">0</span><span class="s1">] </span><span class="s0">in </span><span class="s4">'-0123456789' </span><span class="s0">or</span>
                    <span class="s1">value </span><span class="s0">in </span><span class="s1">(</span><span class="s4">'true'</span><span class="s0">, </span><span class="s4">'false'</span><span class="s1">) </span><span class="s0">or</span>
                    <span class="s1">(value[</span><span class="s2">0</span><span class="s1">] == </span><span class="s4">&quot;[&quot; </span><span class="s0">and </span><span class="s1">value[-</span><span class="s2">1</span><span class="s1">] == </span><span class="s4">&quot;]&quot;</span><span class="s1">) </span><span class="s0">or</span>
                    <span class="s1">(value[</span><span class="s2">0</span><span class="s1">] == </span><span class="s4">'{' </span><span class="s0">and </span><span class="s1">value[-</span><span class="s2">1</span><span class="s1">] == </span><span class="s4">'}'</span><span class="s1">))):</span>
                <span class="s1">groups.append(candidate_group)</span>
            <span class="s0">elif </span><span class="s1">len(candidate_groups) &gt; </span><span class="s2">0</span><span class="s1">:</span>
                <span class="s1">candidate_groups[</span><span class="s2">0</span><span class="s1">] = (candidate_group + </span><span class="s4">&quot;,&quot; </span><span class="s1">+</span>
                                       <span class="s1">candidate_groups[</span><span class="s2">0</span><span class="s1">])</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s0">raise </span><span class="s1">ValueError(</span><span class="s4">&quot;Invalid inline table value encountered&quot;</span><span class="s1">)</span>
        <span class="s0">for </span><span class="s1">group </span><span class="s0">in </span><span class="s1">groups:</span>
            <span class="s1">status = self.load_line(group</span><span class="s0">, </span><span class="s1">currentlevel</span><span class="s0">, </span><span class="s1">multikey</span><span class="s0">,</span>
                                    <span class="s1">multibackslash)</span>
            <span class="s0">if </span><span class="s1">status </span><span class="s0">is not None</span><span class="s1">:</span>
                <span class="s0">break</span>

    <span class="s0">def </span><span class="s1">_get_split_on_quotes(self</span><span class="s0">, </span><span class="s1">line):</span>
        <span class="s1">doublequotesplits = line.split(</span><span class="s4">'&quot;'</span><span class="s1">)</span>
        <span class="s1">quoted = </span><span class="s0">False</span>
        <span class="s1">quotesplits = []</span>
        <span class="s0">if </span><span class="s1">len(doublequotesplits) &gt; </span><span class="s2">1 </span><span class="s0">and </span><span class="s4">&quot;'&quot; </span><span class="s0">in </span><span class="s1">doublequotesplits[</span><span class="s2">0</span><span class="s1">]:</span>
            <span class="s1">singlequotesplits = doublequotesplits[</span><span class="s2">0</span><span class="s1">].split(</span><span class="s4">&quot;'&quot;</span><span class="s1">)</span>
            <span class="s1">doublequotesplits = doublequotesplits[</span><span class="s2">1</span><span class="s1">:]</span>
            <span class="s0">while </span><span class="s1">len(singlequotesplits) % </span><span class="s2">2 </span><span class="s1">== </span><span class="s2">0 </span><span class="s0">and </span><span class="s1">len(doublequotesplits):</span>
                <span class="s1">singlequotesplits[-</span><span class="s2">1</span><span class="s1">] += </span><span class="s4">'&quot;' </span><span class="s1">+ doublequotesplits[</span><span class="s2">0</span><span class="s1">]</span>
                <span class="s1">doublequotesplits = doublequotesplits[</span><span class="s2">1</span><span class="s1">:]</span>
                <span class="s0">if </span><span class="s4">&quot;'&quot; </span><span class="s0">in </span><span class="s1">singlequotesplits[-</span><span class="s2">1</span><span class="s1">]:</span>
                    <span class="s1">singlequotesplits = (singlequotesplits[:-</span><span class="s2">1</span><span class="s1">] +</span>
                                         <span class="s1">singlequotesplits[-</span><span class="s2">1</span><span class="s1">].split(</span><span class="s4">&quot;'&quot;</span><span class="s1">))</span>
            <span class="s1">quotesplits += singlequotesplits</span>
        <span class="s0">for </span><span class="s1">doublequotesplit </span><span class="s0">in </span><span class="s1">doublequotesplits:</span>
            <span class="s0">if </span><span class="s1">quoted:</span>
                <span class="s1">quotesplits.append(doublequotesplit)</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s1">quotesplits += doublequotesplit.split(</span><span class="s4">&quot;'&quot;</span><span class="s1">)</span>
                <span class="s1">quoted = </span><span class="s0">not </span><span class="s1">quoted</span>
        <span class="s0">return </span><span class="s1">quotesplits</span>

    <span class="s0">def </span><span class="s1">load_line(self</span><span class="s0">, </span><span class="s1">line</span><span class="s0">, </span><span class="s1">currentlevel</span><span class="s0">, </span><span class="s1">multikey</span><span class="s0">, </span><span class="s1">multibackslash):</span>
        <span class="s1">i = </span><span class="s2">1</span>
        <span class="s1">quotesplits = self._get_split_on_quotes(line)</span>
        <span class="s1">quoted = </span><span class="s0">False</span>
        <span class="s0">for </span><span class="s1">quotesplit </span><span class="s0">in </span><span class="s1">quotesplits:</span>
            <span class="s0">if not </span><span class="s1">quoted </span><span class="s0">and </span><span class="s4">'=' </span><span class="s0">in </span><span class="s1">quotesplit:</span>
                <span class="s0">break</span>
            <span class="s1">i += quotesplit.count(</span><span class="s4">'='</span><span class="s1">)</span>
            <span class="s1">quoted = </span><span class="s0">not </span><span class="s1">quoted</span>
        <span class="s1">pair = line.split(</span><span class="s4">'='</span><span class="s0">, </span><span class="s1">i)</span>
        <span class="s1">strictly_valid = _strictly_valid_num(pair[-</span><span class="s2">1</span><span class="s1">])</span>
        <span class="s0">if </span><span class="s1">_number_with_underscores.match(pair[-</span><span class="s2">1</span><span class="s1">]):</span>
            <span class="s1">pair[-</span><span class="s2">1</span><span class="s1">] = pair[-</span><span class="s2">1</span><span class="s1">].replace(</span><span class="s4">'_'</span><span class="s0">, </span><span class="s4">''</span><span class="s1">)</span>
        <span class="s0">while </span><span class="s1">len(pair[-</span><span class="s2">1</span><span class="s1">]) </span><span class="s0">and </span><span class="s1">(pair[-</span><span class="s2">1</span><span class="s1">][</span><span class="s2">0</span><span class="s1">] != </span><span class="s4">' ' </span><span class="s0">and </span><span class="s1">pair[-</span><span class="s2">1</span><span class="s1">][</span><span class="s2">0</span><span class="s1">] != </span><span class="s4">'</span><span class="s0">\t</span><span class="s4">' </span><span class="s0">and</span>
                                 <span class="s1">pair[-</span><span class="s2">1</span><span class="s1">][</span><span class="s2">0</span><span class="s1">] != </span><span class="s4">&quot;'&quot; </span><span class="s0">and </span><span class="s1">pair[-</span><span class="s2">1</span><span class="s1">][</span><span class="s2">0</span><span class="s1">] != </span><span class="s4">'&quot;' </span><span class="s0">and</span>
                                 <span class="s1">pair[-</span><span class="s2">1</span><span class="s1">][</span><span class="s2">0</span><span class="s1">] != </span><span class="s4">'[' </span><span class="s0">and </span><span class="s1">pair[-</span><span class="s2">1</span><span class="s1">][</span><span class="s2">0</span><span class="s1">] != </span><span class="s4">'{' </span><span class="s0">and</span>
                                 <span class="s1">pair[-</span><span class="s2">1</span><span class="s1">].strip() != </span><span class="s4">'true' </span><span class="s0">and</span>
                                 <span class="s1">pair[-</span><span class="s2">1</span><span class="s1">].strip() != </span><span class="s4">'false'</span><span class="s1">):</span>
            <span class="s0">try</span><span class="s1">:</span>
                <span class="s1">float(pair[-</span><span class="s2">1</span><span class="s1">])</span>
                <span class="s0">break</span>
            <span class="s0">except </span><span class="s1">ValueError:</span>
                <span class="s0">pass</span>
            <span class="s0">if </span><span class="s1">_load_date(pair[-</span><span class="s2">1</span><span class="s1">]) </span><span class="s0">is not None</span><span class="s1">:</span>
                <span class="s0">break</span>
            <span class="s0">if </span><span class="s1">TIME_RE.match(pair[-</span><span class="s2">1</span><span class="s1">]):</span>
                <span class="s0">break</span>
            <span class="s1">i += </span><span class="s2">1</span>
            <span class="s1">prev_val = pair[-</span><span class="s2">1</span><span class="s1">]</span>
            <span class="s1">pair = line.split(</span><span class="s4">'='</span><span class="s0">, </span><span class="s1">i)</span>
            <span class="s0">if </span><span class="s1">prev_val == pair[-</span><span class="s2">1</span><span class="s1">]:</span>
                <span class="s0">raise </span><span class="s1">ValueError(</span><span class="s4">&quot;Invalid date or number&quot;</span><span class="s1">)</span>
            <span class="s0">if </span><span class="s1">strictly_valid:</span>
                <span class="s1">strictly_valid = _strictly_valid_num(pair[-</span><span class="s2">1</span><span class="s1">])</span>
        <span class="s1">pair = [</span><span class="s4">'='</span><span class="s1">.join(pair[:-</span><span class="s2">1</span><span class="s1">]).strip()</span><span class="s0">, </span><span class="s1">pair[-</span><span class="s2">1</span><span class="s1">].strip()]</span>
        <span class="s0">if </span><span class="s4">'.' </span><span class="s0">in </span><span class="s1">pair[</span><span class="s2">0</span><span class="s1">]:</span>
            <span class="s0">if </span><span class="s4">'&quot;' </span><span class="s0">in </span><span class="s1">pair[</span><span class="s2">0</span><span class="s1">] </span><span class="s0">or </span><span class="s4">&quot;'&quot; </span><span class="s0">in </span><span class="s1">pair[</span><span class="s2">0</span><span class="s1">]:</span>
                <span class="s1">quotesplits = self._get_split_on_quotes(pair[</span><span class="s2">0</span><span class="s1">])</span>
                <span class="s1">quoted = </span><span class="s0">False</span>
                <span class="s1">levels = []</span>
                <span class="s0">for </span><span class="s1">quotesplit </span><span class="s0">in </span><span class="s1">quotesplits:</span>
                    <span class="s0">if </span><span class="s1">quoted:</span>
                        <span class="s1">levels.append(quotesplit)</span>
                    <span class="s0">else</span><span class="s1">:</span>
                        <span class="s1">levels += [level.strip() </span><span class="s0">for </span><span class="s1">level </span><span class="s0">in</span>
                                   <span class="s1">quotesplit.split(</span><span class="s4">'.'</span><span class="s1">)]</span>
                    <span class="s1">quoted = </span><span class="s0">not </span><span class="s1">quoted</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s1">levels = pair[</span><span class="s2">0</span><span class="s1">].split(</span><span class="s4">'.'</span><span class="s1">)</span>
            <span class="s0">while </span><span class="s1">levels[-</span><span class="s2">1</span><span class="s1">] == </span><span class="s4">&quot;&quot;</span><span class="s1">:</span>
                <span class="s1">levels = levels[:-</span><span class="s2">1</span><span class="s1">]</span>
            <span class="s0">for </span><span class="s1">level </span><span class="s0">in </span><span class="s1">levels[:-</span><span class="s2">1</span><span class="s1">]:</span>
                <span class="s0">if </span><span class="s1">level == </span><span class="s4">&quot;&quot;</span><span class="s1">:</span>
                    <span class="s0">continue</span>
                <span class="s0">if </span><span class="s1">level </span><span class="s0">not in </span><span class="s1">currentlevel:</span>
                    <span class="s1">currentlevel[level] = self.get_empty_table()</span>
                <span class="s1">currentlevel = currentlevel[level]</span>
            <span class="s1">pair[</span><span class="s2">0</span><span class="s1">] = levels[-</span><span class="s2">1</span><span class="s1">].strip()</span>
        <span class="s0">elif </span><span class="s1">(pair[</span><span class="s2">0</span><span class="s1">][</span><span class="s2">0</span><span class="s1">] == </span><span class="s4">'&quot;' </span><span class="s0">or </span><span class="s1">pair[</span><span class="s2">0</span><span class="s1">][</span><span class="s2">0</span><span class="s1">] == </span><span class="s4">&quot;'&quot;</span><span class="s1">) </span><span class="s0">and </span><span class="s1">\</span>
                <span class="s1">(pair[</span><span class="s2">0</span><span class="s1">][-</span><span class="s2">1</span><span class="s1">] == pair[</span><span class="s2">0</span><span class="s1">][</span><span class="s2">0</span><span class="s1">]):</span>
            <span class="s1">pair[</span><span class="s2">0</span><span class="s1">] = _unescape(pair[</span><span class="s2">0</span><span class="s1">][</span><span class="s2">1</span><span class="s1">:-</span><span class="s2">1</span><span class="s1">])</span>
        <span class="s1">k</span><span class="s0">, </span><span class="s1">koffset = self._load_line_multiline_str(pair[</span><span class="s2">1</span><span class="s1">])</span>
        <span class="s0">if </span><span class="s1">k &gt; -</span><span class="s2">1</span><span class="s1">:</span>
            <span class="s0">while </span><span class="s1">k &gt; -</span><span class="s2">1 </span><span class="s0">and </span><span class="s1">pair[</span><span class="s2">1</span><span class="s1">][k + koffset] == </span><span class="s4">'</span><span class="s0">\\</span><span class="s4">'</span><span class="s1">:</span>
                <span class="s1">multibackslash = </span><span class="s0">not </span><span class="s1">multibackslash</span>
                <span class="s1">k -= </span><span class="s2">1</span>
            <span class="s0">if </span><span class="s1">multibackslash:</span>
                <span class="s1">multilinestr = pair[</span><span class="s2">1</span><span class="s1">][:-</span><span class="s2">1</span><span class="s1">]</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s1">multilinestr = pair[</span><span class="s2">1</span><span class="s1">] + </span><span class="s4">&quot;</span><span class="s0">\n</span><span class="s4">&quot;</span>
            <span class="s1">multikey = pair[</span><span class="s2">0</span><span class="s1">]</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">value</span><span class="s0">, </span><span class="s1">vtype = self.load_value(pair[</span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">strictly_valid)</span>
        <span class="s0">try</span><span class="s1">:</span>
            <span class="s1">currentlevel[pair[</span><span class="s2">0</span><span class="s1">]]</span>
            <span class="s0">raise </span><span class="s1">ValueError(</span><span class="s4">&quot;Duplicate keys!&quot;</span><span class="s1">)</span>
        <span class="s0">except </span><span class="s1">TypeError:</span>
            <span class="s0">raise </span><span class="s1">ValueError(</span><span class="s4">&quot;Duplicate keys!&quot;</span><span class="s1">)</span>
        <span class="s0">except </span><span class="s1">KeyError:</span>
            <span class="s0">if </span><span class="s1">multikey:</span>
                <span class="s0">return </span><span class="s1">multikey</span><span class="s0">, </span><span class="s1">multilinestr</span><span class="s0">, </span><span class="s1">multibackslash</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s1">currentlevel[pair[</span><span class="s2">0</span><span class="s1">]] = value</span>

    <span class="s0">def </span><span class="s1">_load_line_multiline_str(self</span><span class="s0">, </span><span class="s1">p):</span>
        <span class="s1">poffset = </span><span class="s2">0</span>
        <span class="s0">if </span><span class="s1">len(p) &lt; </span><span class="s2">3</span><span class="s1">:</span>
            <span class="s0">return </span><span class="s1">-</span><span class="s2">1</span><span class="s0">, </span><span class="s1">poffset</span>
        <span class="s0">if </span><span class="s1">p[</span><span class="s2">0</span><span class="s1">] == </span><span class="s4">'[' </span><span class="s0">and </span><span class="s1">(p.strip()[-</span><span class="s2">1</span><span class="s1">] != </span><span class="s4">']' </span><span class="s0">and</span>
                            <span class="s1">self._load_array_isstrarray(p)):</span>
            <span class="s1">newp = p[</span><span class="s2">1</span><span class="s1">:].strip().split(</span><span class="s4">','</span><span class="s1">)</span>
            <span class="s0">while </span><span class="s1">len(newp) &gt; </span><span class="s2">1 </span><span class="s0">and </span><span class="s1">newp[-</span><span class="s2">1</span><span class="s1">][</span><span class="s2">0</span><span class="s1">] != </span><span class="s4">'&quot;' </span><span class="s0">and </span><span class="s1">newp[-</span><span class="s2">1</span><span class="s1">][</span><span class="s2">0</span><span class="s1">] != </span><span class="s4">&quot;'&quot;</span><span class="s1">:</span>
                <span class="s1">newp = newp[:-</span><span class="s2">2</span><span class="s1">] + [newp[-</span><span class="s2">2</span><span class="s1">] + </span><span class="s4">',' </span><span class="s1">+ newp[-</span><span class="s2">1</span><span class="s1">]]</span>
            <span class="s1">newp = newp[-</span><span class="s2">1</span><span class="s1">]</span>
            <span class="s1">poffset = len(p) - len(newp)</span>
            <span class="s1">p = newp</span>
        <span class="s0">if </span><span class="s1">p[</span><span class="s2">0</span><span class="s1">] != </span><span class="s4">'&quot;' </span><span class="s0">and </span><span class="s1">p[</span><span class="s2">0</span><span class="s1">] != </span><span class="s4">&quot;'&quot;</span><span class="s1">:</span>
            <span class="s0">return </span><span class="s1">-</span><span class="s2">1</span><span class="s0">, </span><span class="s1">poffset</span>
        <span class="s0">if </span><span class="s1">p[</span><span class="s2">1</span><span class="s1">] != p[</span><span class="s2">0</span><span class="s1">] </span><span class="s0">or </span><span class="s1">p[</span><span class="s2">2</span><span class="s1">] != p[</span><span class="s2">0</span><span class="s1">]:</span>
            <span class="s0">return </span><span class="s1">-</span><span class="s2">1</span><span class="s0">, </span><span class="s1">poffset</span>
        <span class="s0">if </span><span class="s1">len(p) &gt; </span><span class="s2">5 </span><span class="s0">and </span><span class="s1">p[-</span><span class="s2">1</span><span class="s1">] == p[</span><span class="s2">0</span><span class="s1">] </span><span class="s0">and </span><span class="s1">p[-</span><span class="s2">2</span><span class="s1">] == p[</span><span class="s2">0</span><span class="s1">] </span><span class="s0">and </span><span class="s1">p[-</span><span class="s2">3</span><span class="s1">] == p[</span><span class="s2">0</span><span class="s1">]:</span>
            <span class="s0">return </span><span class="s1">-</span><span class="s2">1</span><span class="s0">, </span><span class="s1">poffset</span>
        <span class="s0">return </span><span class="s1">len(p) - </span><span class="s2">1</span><span class="s0">, </span><span class="s1">poffset</span>

    <span class="s0">def </span><span class="s1">load_value(self</span><span class="s0">, </span><span class="s1">v</span><span class="s0">, </span><span class="s1">strictly_valid=</span><span class="s0">True</span><span class="s1">):</span>
        <span class="s0">if not </span><span class="s1">v:</span>
            <span class="s0">raise </span><span class="s1">ValueError(</span><span class="s4">&quot;Empty value is invalid&quot;</span><span class="s1">)</span>
        <span class="s0">if </span><span class="s1">v == </span><span class="s4">'true'</span><span class="s1">:</span>
            <span class="s0">return </span><span class="s1">(</span><span class="s0">True, </span><span class="s4">&quot;bool&quot;</span><span class="s1">)</span>
        <span class="s0">elif </span><span class="s1">v.lower() == </span><span class="s4">'true'</span><span class="s1">:</span>
            <span class="s0">raise </span><span class="s1">ValueError(</span><span class="s4">&quot;Only all lowercase booleans allowed&quot;</span><span class="s1">)</span>
        <span class="s0">elif </span><span class="s1">v == </span><span class="s4">'false'</span><span class="s1">:</span>
            <span class="s0">return </span><span class="s1">(</span><span class="s0">False, </span><span class="s4">&quot;bool&quot;</span><span class="s1">)</span>
        <span class="s0">elif </span><span class="s1">v.lower() == </span><span class="s4">'false'</span><span class="s1">:</span>
            <span class="s0">raise </span><span class="s1">ValueError(</span><span class="s4">&quot;Only all lowercase booleans allowed&quot;</span><span class="s1">)</span>
        <span class="s0">elif </span><span class="s1">v[</span><span class="s2">0</span><span class="s1">] == </span><span class="s4">'&quot;' </span><span class="s0">or </span><span class="s1">v[</span><span class="s2">0</span><span class="s1">] == </span><span class="s4">&quot;'&quot;</span><span class="s1">:</span>
            <span class="s1">quotechar = v[</span><span class="s2">0</span><span class="s1">]</span>
            <span class="s1">testv = v[</span><span class="s2">1</span><span class="s1">:].split(quotechar)</span>
            <span class="s1">triplequote = </span><span class="s0">False</span>
            <span class="s1">triplequotecount = </span><span class="s2">0</span>
            <span class="s0">if </span><span class="s1">len(testv) &gt; </span><span class="s2">1 </span><span class="s0">and </span><span class="s1">testv[</span><span class="s2">0</span><span class="s1">] == </span><span class="s4">'' </span><span class="s0">and </span><span class="s1">testv[</span><span class="s2">1</span><span class="s1">] == </span><span class="s4">''</span><span class="s1">:</span>
                <span class="s1">testv = testv[</span><span class="s2">2</span><span class="s1">:]</span>
                <span class="s1">triplequote = </span><span class="s0">True</span>
            <span class="s1">closed = </span><span class="s0">False</span>
            <span class="s0">for </span><span class="s1">tv </span><span class="s0">in </span><span class="s1">testv:</span>
                <span class="s0">if </span><span class="s1">tv == </span><span class="s4">''</span><span class="s1">:</span>
                    <span class="s0">if </span><span class="s1">triplequote:</span>
                        <span class="s1">triplequotecount += </span><span class="s2">1</span>
                    <span class="s0">else</span><span class="s1">:</span>
                        <span class="s1">closed = </span><span class="s0">True</span>
                <span class="s0">else</span><span class="s1">:</span>
                    <span class="s1">oddbackslash = </span><span class="s0">False</span>
                    <span class="s0">try</span><span class="s1">:</span>
                        <span class="s1">i = -</span><span class="s2">1</span>
                        <span class="s1">j = tv[i]</span>
                        <span class="s0">while </span><span class="s1">j == </span><span class="s4">'</span><span class="s0">\\</span><span class="s4">'</span><span class="s1">:</span>
                            <span class="s1">oddbackslash = </span><span class="s0">not </span><span class="s1">oddbackslash</span>
                            <span class="s1">i -= </span><span class="s2">1</span>
                            <span class="s1">j = tv[i]</span>
                    <span class="s0">except </span><span class="s1">IndexError:</span>
                        <span class="s0">pass</span>
                    <span class="s0">if not </span><span class="s1">oddbackslash:</span>
                        <span class="s0">if </span><span class="s1">closed:</span>
                            <span class="s0">raise </span><span class="s1">ValueError(</span><span class="s4">&quot;Found tokens after a closed &quot; </span><span class="s1">+</span>
                                             <span class="s4">&quot;string. Invalid TOML.&quot;</span><span class="s1">)</span>
                        <span class="s0">else</span><span class="s1">:</span>
                            <span class="s0">if not </span><span class="s1">triplequote </span><span class="s0">or </span><span class="s1">triplequotecount &gt; </span><span class="s2">1</span><span class="s1">:</span>
                                <span class="s1">closed = </span><span class="s0">True</span>
                            <span class="s0">else</span><span class="s1">:</span>
                                <span class="s1">triplequotecount = </span><span class="s2">0</span>
            <span class="s0">if </span><span class="s1">quotechar == </span><span class="s4">'&quot;'</span><span class="s1">:</span>
                <span class="s1">escapeseqs = v.split(</span><span class="s4">'</span><span class="s0">\\</span><span class="s4">'</span><span class="s1">)[</span><span class="s2">1</span><span class="s1">:]</span>
                <span class="s1">backslash = </span><span class="s0">False</span>
                <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">escapeseqs:</span>
                    <span class="s0">if </span><span class="s1">i == </span><span class="s4">''</span><span class="s1">:</span>
                        <span class="s1">backslash = </span><span class="s0">not </span><span class="s1">backslash</span>
                    <span class="s0">else</span><span class="s1">:</span>
                        <span class="s0">if </span><span class="s1">i[</span><span class="s2">0</span><span class="s1">] </span><span class="s0">not in </span><span class="s1">_escapes </span><span class="s0">and </span><span class="s1">(i[</span><span class="s2">0</span><span class="s1">] != </span><span class="s4">'u' </span><span class="s0">and</span>
                                                     <span class="s1">i[</span><span class="s2">0</span><span class="s1">] != </span><span class="s4">'U' </span><span class="s0">and</span>
                                                     <span class="s0">not </span><span class="s1">backslash):</span>
                            <span class="s0">raise </span><span class="s1">ValueError(</span><span class="s4">&quot;Reserved escape sequence used&quot;</span><span class="s1">)</span>
                        <span class="s0">if </span><span class="s1">backslash:</span>
                            <span class="s1">backslash = </span><span class="s0">False</span>
                <span class="s0">for </span><span class="s1">prefix </span><span class="s0">in </span><span class="s1">[</span><span class="s4">&quot;</span><span class="s0">\\</span><span class="s4">u&quot;</span><span class="s0">, </span><span class="s4">&quot;</span><span class="s0">\\</span><span class="s4">U&quot;</span><span class="s1">]:</span>
                    <span class="s0">if </span><span class="s1">prefix </span><span class="s0">in </span><span class="s1">v:</span>
                        <span class="s1">hexbytes = v.split(prefix)</span>
                        <span class="s1">v = _load_unicode_escapes(hexbytes[</span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">hexbytes[</span><span class="s2">1</span><span class="s1">:]</span><span class="s0">,</span>
                                                  <span class="s1">prefix)</span>
                <span class="s1">v = _unescape(v)</span>
            <span class="s0">if </span><span class="s1">len(v) &gt; </span><span class="s2">1 </span><span class="s0">and </span><span class="s1">v[</span><span class="s2">1</span><span class="s1">] == quotechar </span><span class="s0">and </span><span class="s1">(len(v) &lt; </span><span class="s2">3 </span><span class="s0">or</span>
                                                     <span class="s1">v[</span><span class="s2">1</span><span class="s1">] == v[</span><span class="s2">2</span><span class="s1">]):</span>
                <span class="s1">v = v[</span><span class="s2">2</span><span class="s1">:-</span><span class="s2">2</span><span class="s1">]</span>
            <span class="s0">return </span><span class="s1">(v[</span><span class="s2">1</span><span class="s1">:-</span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s4">&quot;str&quot;</span><span class="s1">)</span>
        <span class="s0">elif </span><span class="s1">v[</span><span class="s2">0</span><span class="s1">] == </span><span class="s4">'['</span><span class="s1">:</span>
            <span class="s0">return </span><span class="s1">(self.load_array(v)</span><span class="s0">, </span><span class="s4">&quot;array&quot;</span><span class="s1">)</span>
        <span class="s0">elif </span><span class="s1">v[</span><span class="s2">0</span><span class="s1">] == </span><span class="s4">'{'</span><span class="s1">:</span>
            <span class="s1">inline_object = self.get_empty_inline_table()</span>
            <span class="s1">self.load_inline_object(v</span><span class="s0">, </span><span class="s1">inline_object)</span>
            <span class="s0">return </span><span class="s1">(inline_object</span><span class="s0">, </span><span class="s4">&quot;inline_object&quot;</span><span class="s1">)</span>
        <span class="s0">elif </span><span class="s1">TIME_RE.match(v):</span>
            <span class="s1">h</span><span class="s0">, </span><span class="s1">m</span><span class="s0">, </span><span class="s1">s</span><span class="s0">, </span><span class="s1">_</span><span class="s0">, </span><span class="s1">ms = TIME_RE.match(v).groups()</span>
            <span class="s1">time = datetime.time(int(h)</span><span class="s0">, </span><span class="s1">int(m)</span><span class="s0">, </span><span class="s1">int(s)</span><span class="s0">, </span><span class="s1">int(ms) </span><span class="s0">if </span><span class="s1">ms </span><span class="s0">else </span><span class="s2">0</span><span class="s1">)</span>
            <span class="s0">return </span><span class="s1">(time</span><span class="s0">, </span><span class="s4">&quot;time&quot;</span><span class="s1">)</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">parsed_date = _load_date(v)</span>
            <span class="s0">if </span><span class="s1">parsed_date </span><span class="s0">is not None</span><span class="s1">:</span>
                <span class="s0">return </span><span class="s1">(parsed_date</span><span class="s0">, </span><span class="s4">&quot;date&quot;</span><span class="s1">)</span>
            <span class="s0">if not </span><span class="s1">strictly_valid:</span>
                <span class="s0">raise </span><span class="s1">ValueError(</span><span class="s4">&quot;Weirdness with leading zeroes or &quot;</span>
                                 <span class="s4">&quot;underscores in your number.&quot;</span><span class="s1">)</span>
            <span class="s1">itype = </span><span class="s4">&quot;int&quot;</span>
            <span class="s1">neg = </span><span class="s0">False</span>
            <span class="s0">if </span><span class="s1">v[</span><span class="s2">0</span><span class="s1">] == </span><span class="s4">'-'</span><span class="s1">:</span>
                <span class="s1">neg = </span><span class="s0">True</span>
                <span class="s1">v = v[</span><span class="s2">1</span><span class="s1">:]</span>
            <span class="s0">elif </span><span class="s1">v[</span><span class="s2">0</span><span class="s1">] == </span><span class="s4">'+'</span><span class="s1">:</span>
                <span class="s1">v = v[</span><span class="s2">1</span><span class="s1">:]</span>
            <span class="s1">v = v.replace(</span><span class="s4">'_'</span><span class="s0">, </span><span class="s4">''</span><span class="s1">)</span>
            <span class="s1">lowerv = v.lower()</span>
            <span class="s0">if </span><span class="s4">'.' </span><span class="s0">in </span><span class="s1">v </span><span class="s0">or </span><span class="s1">(</span><span class="s4">'x' </span><span class="s0">not in </span><span class="s1">v </span><span class="s0">and </span><span class="s1">(</span><span class="s4">'e' </span><span class="s0">in </span><span class="s1">v </span><span class="s0">or </span><span class="s4">'E' </span><span class="s0">in </span><span class="s1">v)):</span>
                <span class="s0">if </span><span class="s4">'.' </span><span class="s0">in </span><span class="s1">v </span><span class="s0">and </span><span class="s1">v.split(</span><span class="s4">'.'</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)[</span><span class="s2">1</span><span class="s1">] == </span><span class="s4">''</span><span class="s1">:</span>
                    <span class="s0">raise </span><span class="s1">ValueError(</span><span class="s4">&quot;This float is missing digits after &quot;</span>
                                     <span class="s4">&quot;the point&quot;</span><span class="s1">)</span>
                <span class="s0">if </span><span class="s1">v[</span><span class="s2">0</span><span class="s1">] </span><span class="s0">not in </span><span class="s4">'0123456789'</span><span class="s1">:</span>
                    <span class="s0">raise </span><span class="s1">ValueError(</span><span class="s4">&quot;This float doesn't have a leading &quot;</span>
                                     <span class="s4">&quot;digit&quot;</span><span class="s1">)</span>
                <span class="s1">v = float(v)</span>
                <span class="s1">itype = </span><span class="s4">&quot;float&quot;</span>
            <span class="s0">elif </span><span class="s1">len(lowerv) == </span><span class="s2">3 </span><span class="s0">and </span><span class="s1">(lowerv == </span><span class="s4">'inf' </span><span class="s0">or </span><span class="s1">lowerv == </span><span class="s4">'nan'</span><span class="s1">):</span>
                <span class="s1">v = float(v)</span>
                <span class="s1">itype = </span><span class="s4">&quot;float&quot;</span>
            <span class="s0">if </span><span class="s1">itype == </span><span class="s4">&quot;int&quot;</span><span class="s1">:</span>
                <span class="s1">v = int(v</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)</span>
            <span class="s0">if </span><span class="s1">neg:</span>
                <span class="s0">return </span><span class="s1">(</span><span class="s2">0 </span><span class="s1">- v</span><span class="s0">, </span><span class="s1">itype)</span>
            <span class="s0">return </span><span class="s1">(v</span><span class="s0">, </span><span class="s1">itype)</span>

    <span class="s0">def </span><span class="s1">bounded_string(self</span><span class="s0">, </span><span class="s1">s):</span>
        <span class="s0">if </span><span class="s1">len(s) == </span><span class="s2">0</span><span class="s1">:</span>
            <span class="s0">return True</span>
        <span class="s0">if </span><span class="s1">s[-</span><span class="s2">1</span><span class="s1">] != s[</span><span class="s2">0</span><span class="s1">]:</span>
            <span class="s0">return False</span>
        <span class="s1">i = -</span><span class="s2">2</span>
        <span class="s1">backslash = </span><span class="s0">False</span>
        <span class="s0">while </span><span class="s1">len(s) + i &gt; </span><span class="s2">0</span><span class="s1">:</span>
            <span class="s0">if </span><span class="s1">s[i] == </span><span class="s4">&quot;</span><span class="s0">\\</span><span class="s4">&quot;</span><span class="s1">:</span>
                <span class="s1">backslash = </span><span class="s0">not </span><span class="s1">backslash</span>
                <span class="s1">i -= </span><span class="s2">1</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s0">break</span>
        <span class="s0">return not </span><span class="s1">backslash</span>

    <span class="s0">def </span><span class="s1">_load_array_isstrarray(self</span><span class="s0">, </span><span class="s1">a):</span>
        <span class="s1">a = a[</span><span class="s2">1</span><span class="s1">:-</span><span class="s2">1</span><span class="s1">].strip()</span>
        <span class="s0">if </span><span class="s1">a != </span><span class="s4">'' </span><span class="s0">and </span><span class="s1">(a[</span><span class="s2">0</span><span class="s1">] == </span><span class="s4">'&quot;' </span><span class="s0">or </span><span class="s1">a[</span><span class="s2">0</span><span class="s1">] == </span><span class="s4">&quot;'&quot;</span><span class="s1">):</span>
            <span class="s0">return True</span>
        <span class="s0">return False</span>

    <span class="s0">def </span><span class="s1">load_array(self</span><span class="s0">, </span><span class="s1">a):</span>
        <span class="s1">atype = </span><span class="s0">None</span>
        <span class="s1">retval = []</span>
        <span class="s1">a = a.strip()</span>
        <span class="s0">if </span><span class="s4">'[' </span><span class="s0">not in </span><span class="s1">a[</span><span class="s2">1</span><span class="s1">:-</span><span class="s2">1</span><span class="s1">] </span><span class="s0">or </span><span class="s4">&quot;&quot; </span><span class="s1">!= a[</span><span class="s2">1</span><span class="s1">:-</span><span class="s2">1</span><span class="s1">].split(</span><span class="s4">'['</span><span class="s1">)[</span><span class="s2">0</span><span class="s1">].strip():</span>
            <span class="s1">strarray = self._load_array_isstrarray(a)</span>
            <span class="s0">if not </span><span class="s1">a[</span><span class="s2">1</span><span class="s1">:-</span><span class="s2">1</span><span class="s1">].strip().startswith(</span><span class="s4">'{'</span><span class="s1">):</span>
                <span class="s1">a = a[</span><span class="s2">1</span><span class="s1">:-</span><span class="s2">1</span><span class="s1">].split(</span><span class="s4">','</span><span class="s1">)</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s3"># a is an inline object, we must find the matching parenthesis</span>
                <span class="s3"># to define groups</span>
                <span class="s1">new_a = []</span>
                <span class="s1">start_group_index = </span><span class="s2">1</span>
                <span class="s1">end_group_index = </span><span class="s2">2</span>
                <span class="s1">open_bracket_count = </span><span class="s2">1 </span><span class="s0">if </span><span class="s1">a[start_group_index] == </span><span class="s4">'{' </span><span class="s0">else </span><span class="s2">0</span>
                <span class="s1">in_str = </span><span class="s0">False</span>
                <span class="s0">while </span><span class="s1">end_group_index &lt; len(a[</span><span class="s2">1</span><span class="s1">:]):</span>
                    <span class="s0">if </span><span class="s1">a[end_group_index] == </span><span class="s4">'&quot;' </span><span class="s0">or </span><span class="s1">a[end_group_index] == </span><span class="s4">&quot;'&quot;</span><span class="s1">:</span>
                        <span class="s0">if </span><span class="s1">in_str:</span>
                            <span class="s1">backslash_index = end_group_index - </span><span class="s2">1</span>
                            <span class="s0">while </span><span class="s1">(backslash_index &gt; -</span><span class="s2">1 </span><span class="s0">and</span>
                                   <span class="s1">a[backslash_index] == </span><span class="s4">'</span><span class="s0">\\</span><span class="s4">'</span><span class="s1">):</span>
                                <span class="s1">in_str = </span><span class="s0">not </span><span class="s1">in_str</span>
                                <span class="s1">backslash_index -= </span><span class="s2">1</span>
                        <span class="s1">in_str = </span><span class="s0">not </span><span class="s1">in_str</span>
                    <span class="s0">if not </span><span class="s1">in_str </span><span class="s0">and </span><span class="s1">a[end_group_index] == </span><span class="s4">'{'</span><span class="s1">:</span>
                        <span class="s1">open_bracket_count += </span><span class="s2">1</span>
                    <span class="s0">if </span><span class="s1">in_str </span><span class="s0">or </span><span class="s1">a[end_group_index] != </span><span class="s4">'}'</span><span class="s1">:</span>
                        <span class="s1">end_group_index += </span><span class="s2">1</span>
                        <span class="s0">continue</span>
                    <span class="s0">elif </span><span class="s1">a[end_group_index] == </span><span class="s4">'}' </span><span class="s0">and </span><span class="s1">open_bracket_count &gt; </span><span class="s2">1</span><span class="s1">:</span>
                        <span class="s1">open_bracket_count -= </span><span class="s2">1</span>
                        <span class="s1">end_group_index += </span><span class="s2">1</span>
                        <span class="s0">continue</span>

                    <span class="s3"># Increase end_group_index by 1 to get the closing bracket</span>
                    <span class="s1">end_group_index += </span><span class="s2">1</span>

                    <span class="s1">new_a.append(a[start_group_index:end_group_index])</span>

                    <span class="s3"># The next start index is at least after the closing</span>
                    <span class="s3"># bracket, a closing bracket can be followed by a comma</span>
                    <span class="s3"># since we are in an array.</span>
                    <span class="s1">start_group_index = end_group_index + </span><span class="s2">1</span>
                    <span class="s0">while </span><span class="s1">(start_group_index &lt; len(a[</span><span class="s2">1</span><span class="s1">:]) </span><span class="s0">and</span>
                           <span class="s1">a[start_group_index] != </span><span class="s4">'{'</span><span class="s1">):</span>
                        <span class="s1">start_group_index += </span><span class="s2">1</span>
                    <span class="s1">end_group_index = start_group_index + </span><span class="s2">1</span>
                <span class="s1">a = new_a</span>
            <span class="s1">b = </span><span class="s2">0</span>
            <span class="s0">if </span><span class="s1">strarray:</span>
                <span class="s0">while </span><span class="s1">b &lt; len(a) - </span><span class="s2">1</span><span class="s1">:</span>
                    <span class="s1">ab = a[b].strip()</span>
                    <span class="s0">while </span><span class="s1">(</span><span class="s0">not </span><span class="s1">self.bounded_string(ab) </span><span class="s0">or</span>
                           <span class="s1">(len(ab) &gt; </span><span class="s2">2 </span><span class="s0">and</span>
                            <span class="s1">ab[</span><span class="s2">0</span><span class="s1">] == ab[</span><span class="s2">1</span><span class="s1">] == ab[</span><span class="s2">2</span><span class="s1">] </span><span class="s0">and</span>
                            <span class="s1">ab[-</span><span class="s2">2</span><span class="s1">] != ab[</span><span class="s2">0</span><span class="s1">] </span><span class="s0">and</span>
                            <span class="s1">ab[-</span><span class="s2">3</span><span class="s1">] != ab[</span><span class="s2">0</span><span class="s1">])):</span>
                        <span class="s1">a[b] = a[b] + </span><span class="s4">',' </span><span class="s1">+ a[b + </span><span class="s2">1</span><span class="s1">]</span>
                        <span class="s1">ab = a[b].strip()</span>
                        <span class="s0">if </span><span class="s1">b &lt; len(a) - </span><span class="s2">2</span><span class="s1">:</span>
                            <span class="s1">a = a[:b + </span><span class="s2">1</span><span class="s1">] + a[b + </span><span class="s2">2</span><span class="s1">:]</span>
                        <span class="s0">else</span><span class="s1">:</span>
                            <span class="s1">a = a[:b + </span><span class="s2">1</span><span class="s1">]</span>
                    <span class="s1">b += </span><span class="s2">1</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">al = list(a[</span><span class="s2">1</span><span class="s1">:-</span><span class="s2">1</span><span class="s1">])</span>
            <span class="s1">a = []</span>
            <span class="s1">openarr = </span><span class="s2">0</span>
            <span class="s1">j = </span><span class="s2">0</span>
            <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">_range(len(al)):</span>
                <span class="s0">if </span><span class="s1">al[i] == </span><span class="s4">'['</span><span class="s1">:</span>
                    <span class="s1">openarr += </span><span class="s2">1</span>
                <span class="s0">elif </span><span class="s1">al[i] == </span><span class="s4">']'</span><span class="s1">:</span>
                    <span class="s1">openarr -= </span><span class="s2">1</span>
                <span class="s0">elif </span><span class="s1">al[i] == </span><span class="s4">',' </span><span class="s0">and not </span><span class="s1">openarr:</span>
                    <span class="s1">a.append(</span><span class="s4">''</span><span class="s1">.join(al[j:i]))</span>
                    <span class="s1">j = i + </span><span class="s2">1</span>
            <span class="s1">a.append(</span><span class="s4">''</span><span class="s1">.join(al[j:]))</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">_range(len(a)):</span>
            <span class="s1">a[i] = a[i].strip()</span>
            <span class="s0">if </span><span class="s1">a[i] != </span><span class="s4">''</span><span class="s1">:</span>
                <span class="s1">nval</span><span class="s0">, </span><span class="s1">ntype = self.load_value(a[i])</span>
                <span class="s0">if </span><span class="s1">atype:</span>
                    <span class="s0">if </span><span class="s1">ntype != atype:</span>
                        <span class="s0">raise </span><span class="s1">ValueError(</span><span class="s4">&quot;Not a homogeneous array&quot;</span><span class="s1">)</span>
                <span class="s0">else</span><span class="s1">:</span>
                    <span class="s1">atype = ntype</span>
                <span class="s1">retval.append(nval)</span>
        <span class="s0">return </span><span class="s1">retval</span>

    <span class="s0">def </span><span class="s1">preserve_comment(self</span><span class="s0">, </span><span class="s1">line_no</span><span class="s0">, </span><span class="s1">key</span><span class="s0">, </span><span class="s1">comment</span><span class="s0">, </span><span class="s1">beginline):</span>
        <span class="s0">pass</span>

    <span class="s0">def </span><span class="s1">embed_comments(self</span><span class="s0">, </span><span class="s1">idx</span><span class="s0">, </span><span class="s1">currentlevel):</span>
        <span class="s0">pass</span>


<span class="s0">class </span><span class="s1">TomlPreserveCommentDecoder(TomlDecoder):</span>

    <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">, </span><span class="s1">_dict=dict):</span>
        <span class="s1">self.saved_comments = {}</span>
        <span class="s1">super(TomlPreserveCommentDecoder</span><span class="s0">, </span><span class="s1">self).__init__(_dict)</span>

    <span class="s0">def </span><span class="s1">preserve_comment(self</span><span class="s0">, </span><span class="s1">line_no</span><span class="s0">, </span><span class="s1">key</span><span class="s0">, </span><span class="s1">comment</span><span class="s0">, </span><span class="s1">beginline):</span>
        <span class="s1">self.saved_comments[line_no] = (key</span><span class="s0">, </span><span class="s1">comment</span><span class="s0">, </span><span class="s1">beginline)</span>

    <span class="s0">def </span><span class="s1">embed_comments(self</span><span class="s0">, </span><span class="s1">idx</span><span class="s0">, </span><span class="s1">currentlevel):</span>
        <span class="s0">if </span><span class="s1">idx </span><span class="s0">not in </span><span class="s1">self.saved_comments:</span>
            <span class="s0">return</span>

        <span class="s1">key</span><span class="s0">, </span><span class="s1">comment</span><span class="s0">, </span><span class="s1">beginline = self.saved_comments[idx]</span>
        <span class="s1">currentlevel[key] = CommentValue(currentlevel[key]</span><span class="s0">, </span><span class="s1">comment</span><span class="s0">, </span><span class="s1">beginline</span><span class="s0">,</span>
                                         <span class="s1">self._dict)</span>
</pre>
</body>
</html>